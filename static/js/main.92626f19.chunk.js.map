{"version":3,"sources":["tonva-react/index.ts","tonva-react/tool/left0.ts","tonva-react/tool/local.ts","tonva-react/tool/getObjPropIgnoreCase.ts","tonva-react/tool/caseString.ts","tonva-react/components/index.ts","tonva-react/components/nav.tsx","tonva-react/net/netToken.ts","tonva-react/components/fetchErrorView.tsx","tonva-react/components/reloadPage.tsx","tonva-react/uq/build/tools.ts","tonva-react/net/guestApi.ts","tonva-react/net/caller.ts","tonva-react/components/page/page.tsx","tonva-uqui/list/ListPage.tsx","tonva-uqui/list/CList.ts","tonva-uqui/list/MidList.ts","tonva-react/vm/controller.tsx","tonva-react/vm/view.tsx","tonva-react/vm/vpage.tsx","tonva-react/uq/entity.ts","tonva-uqui/tools/pageItems.ts","tonva-uqui/tools/timeSpan.ts","tonva-uqui/tools/parts.tsx","tonva-react/components/edit/itemEdit.tsx","tonva-react/res/formRes.ts","tonva-react/res/listRes.ts","tonva-react/uq/caller.ts","tonva-uqui/base/index.ts","tonva-react/net/httpChannel.ts","tonva-react/net/httpChannelUI.ts","tonva-react/net/uqApi.ts","tonva-uqui/form/VFormView.tsx","tonva-uqui/form/CFormView.ts","tonva-uqui/form/VFormPage.tsx","tonva-uqui/form/CFormPage.ts","tonva-uqui/form/VDialog.tsx","tonva-uqui/form/CFormDialog.ts","tonva-uqui/form/FormUI.ts","tonva-react/uq/query.ts","tonva-uqui/select/CIDSelect.ts","tonva-uqui/select/parts.tsx","tonva-uqui/select/CIXSelect.ts","tonva-uqui/select/createPickId.ts","tonva-react/tool/uid.ts","tonva-react/net/appBridge.ts","tonva-react/net/wsChannel.ts","tonva-react/components/image.tsx","tonva-react/tool/user.ts","tonva-react/net/host.ts","tonva-react/components/page/scrollView.tsx","tonva-react/res/res.ts","tonva-react/uq/action.ts","tonva-react/components/simple/LMR.tsx","tonva-react/components/simple/Badge.tsx","tonva-react/components/simple/FA.tsx","tonva-react/components/simple/IconText.tsx","tonva-react/tool/localDb.ts","tonva-react/uq/tuid/reactBoxId.tsx","tonva-react/components/loading.tsx","tonva-react/tool/env.ts","tonva-react/components/login.tsx","tonva-react/uq/index.ts","tonva-react/uq/tuid/index.ts","tonva-react/uq/ID.ts","tonva-uqui/ID/VEdit.tsx","tonva-uqui/ID/VContent.tsx","tonva-uqui/ID/res/index.ts","tonva-uqui/ID/res/zh.ts","tonva-uqui/ID/res/en.ts","tonva-uqui/ID/CID.ts","tonva-uqui/ID/MidIDList.ts","tonva-uqui/ID/MidID.ts","tonva-uqui/index.ts","tonva-react/net/apiBase.ts","tonva-react/uq/uqsMan.ts","tonva-uqui/IX/CIXList.ts","tonva-uqui/IX/CIX.ts","tonva-uqui/IX/CIXEdit.ts","tonva-react/components/edit/imageItemEdit.tsx","tonva-react/tool/rules.ts","tonva-react/tool/pageItems.ts","tonva-react/tool/62.ts","tonva-react/net/messageHub.ts","tonva-react/components/navigo.ts","tonva-react/components/page/pageHeader.tsx","tonva-react/components/page/tabs.tsx","tonva-react/components/resUploader.tsx","tonva-react/uq/uqMan.ts","tonva-react/uq/sheet.ts","tonva-react/uq/book.ts","tonva-react/uq/history.ts","tonva-react/uq/map.ts","tonva-react/uq/pending.ts","tonva-react/uq/enum.ts","uq-app/uqs/JkMe/index.ts","tonva-react/app/centerApi.ts","tonva-react/app/vMain.tsx","tonva-react/app/CAppBase.ts","tonva-react/app/start.ts","tonva-react/app/CBase.ts","tonva-react/uq/tag/tagView.tsx","tonva-react/uq/tag/tag.ts","tonva-react/uq/build/fieldItem.ts","tonva-react/auth/VLogout.tsx","tonva-react/auth/VLogin.tsx","tonva-react/auth/VChangePassword.tsx","tonva-react/auth/CLogin.tsx","tonva-react/img/logo.svg","tonva-react/auth/tools.tsx","tonva-react/components/page/index.ts","tonva-react/components/schema/index.ts","tonva-react/components/dropDownActions/index.tsx","tonva-react/components/easyDate/index.tsx","tonva-react/components/media.tsx","tonva-react/components/searchBox.tsx","tonva-react/components/userIcon.tsx","tonva-react/components/ax/index.tsx","tonva-react/components/autoHideTips.tsx","tonva-react/uq/tuid/tuidsCache.ts","tonva-react/ui/index.ts","tonva-uqui/base/Mid.ts","tonva-react/components/form/rules/index.ts","tonva-react/components/form/widgets/widget.tsx","tonva-react/components/form/widgets/textWidget.tsx","tonva-react/components/form/widgets/textareaWidget.tsx","tonva-react/components/form/widgets/passwordWidget.tsx","tonva-react/components/form/widgets/numberWidget.tsx","tonva-react/components/form/widgets/updownWidget.tsx","tonva-react/components/form/widgets/dateWidget.tsx","tonva-react/components/form/widgets/checkBoxWidget.tsx","tonva-react/components/form/widgets/selectWidget.tsx","tonva-react/components/form/widgets/radioWidget.tsx","tonva-react/components/form/widgets/rangeWidget.tsx","tonva-react/components/form/widgets/idWidget.tsx","tonva-react/components/form/widgets/unknown.tsx","tonva-react/components/form/widgets/buttonWidget.tsx","tonva-react/components/form/context.tsx","tonva-react/components/form/widgets/arrComponent.tsx","tonva-react/components/form/widgets/imageWidget.tsx","tonva-react/components/form/widgets/tagWidget.tsx","tonva-react/components/form/widgets/factory.tsx","tonva-react/components/form/form.tsx","tonva-react/components/form/field.tsx","tonva-react/components/edit/stringItemEdit.tsx","tonva-react/components/edit/radioItemEdit.tsx","tonva-react/components/edit/selectItemEdit.tsx","tonva-react/components/edit/idItemEdit.tsx","tonva-react/components/edit/tagItemEdit.tsx","tonva-react/components/edit/textAreaItemEdit.tsx","tonva-react/components/edit/checkBoxItemEdit.tsx","tonva-react/components/edit/rangeItemEdit.tsx","tonva-react/components/edit/numberItemEdit.tsx","tonva-react/components/edit/edit.tsx","tonva-uqui/IDX/MidIDXList.ts","tonva-uqui/IDX/res/index.ts","tonva-uqui/IDX/res/zh.ts","tonva-uqui/IDX/res/en.ts","tonva-uqui/IDX/VEdit.tsx","tonva-uqui/IDX/VHistory.tsx","tonva-uqui/IDX/VView.tsx","tonva-uqui/IDX/CIDX.ts","tonva-uqui/IDX/MidIDX.ts","tonva-uqui/tag/MidTag.ts","tonva-uqui/tag/select/VSelect.tsx","tonva-uqui/tag/select/CSelect.ts","tonva-uqui/tag/parts.tsx","tonva-uqui/tag/CIDTagList.ts","tonva-uqui/tag/VTags.tsx","tonva-uqui/tag/CTagIDList.ts","tonva-uqui/sheet/MidSheet.ts","tonva-uqui/sheet/CSheet.ts","tonva-uqui/sheet/VSheetEdit.tsx","tonva-uqui/sheet/VSheetView.tsx","tonva-uqui/roles/VRoles.tsx","tonva-uqui/roles/roleAdmin/VAddUser.tsx","tonva-uqui/roles/roleAdmin/VRoleAdmin.tsx","tonva-uqui/roles/roleAdmin/CRoleAdmin.ts","tonva-uqui/roles/CRoles.ts","tonva-react/components/list/base.tsx","tonva-react/components/list/clickable.tsx","tonva-react/components/list/static.tsx","tonva-react/components/list/selectable.tsx","tonva-react/components/list/index.tsx","tonva-react/components/propGrid/row.tsx","tonva-react/components/propGrid/propView.tsx","tonva-react/components/propGrid/PropGrid.tsx","tonva-react/auth/meInfo.tsx","tonva-react/uq/tuid/idCache.ts","tonva-react/uq/tuid/tuid.ts","tonva-react/uq/build/buildTsUqFolder.ts","tonva-react/uq/build/buildUQ.ts","uq-app/uqs/JkMe/$Piecewise.ui.tsx","uq-app/uqs/JkMe/$PiecewiseDetail.ui.tsx","uq-app/uqs/JkMe/AccountType.ui.tsx","uq-app/uqs/JkMe/Account.ui.tsx","uq-app/uqs/JkMe/AccountCTO.ui.tsx","uq-app/uqs/JkMe/UserAccountType.ui.tsx","reportWebVitals.ts","uq-app/CBase.ts","home/contentManager/VItem.tsx","home/contentManager/VValuePage.tsx","home/contentManager/CContentManager.ts","home/cto/VItem.tsx","home/cto/VValuePage.tsx","home/cto/CCTO.ts","home/VHome.tsx","home/CHome.ts","uq-app/appConfig.ts","me/VAbout.tsx","me/VMe.tsx","me/VEditMe.tsx","me/CMe.ts","uq-app/bug/tester/test-times-change.ts","uq-app/bug/tester/index.ts","uq-app/bug/tester/test1.ts","uq-app/bug/tester/test2.ts","uq-app/bug/tester/test3.ts","uq-app/bug/tester/test4.ts","uq-app/bug/VBug.tsx","uq-app/bug/VConsole.tsx","uq-app/bug/CBug.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/VMain.tsx","uq-app/test-uqui/VTest.tsx","uq-app/test-uqui/CTest.tsx","uq-app/CApp.ts","uq-app/uqs/index.ts","uq-app/App.tsx","index.tsx"],"names":["left0","num","fix","undefined","r","toString","len","length","substr","LocalData","user","env","localDb","child","guest","unit","_user","_guest","_unit","this","get","set","forEach","d","remove","getObjPropIgnoreCase","obj","prop","keys","Object","toLowerCase","key","capitalCase","s","split","map","v","firstCharUppercase","join","camelCase","parts","c","charCodeAt","ACode","ZCode","String","fromCharCode","firstCharLowercase","i","aCode","zCode","logMark","netToken","userId","token","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","push","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","logs","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","window","self","top","postMessage","confirmClose","pop","fetchError","browser","notSupportedBrowser","findIndex","wait","addEventListener","init","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","elWait","elError","test","testing","left","zIndex","name","index","visibility","position","navView","wsHost","local","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","navigator","userAgent","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","id","logined","logout","navLogin","params","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","onChangeLogin","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","waiting","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","makeObservable","observable","lang","resOptions","district","g","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","process","Number","isDevelopment","getPredefinedUnitName","unitName","guestApi","unitFromName","unitId","settings","htmlTitle","html0","getElementsByTagName","getAttribute","oem","origin","pathname","endsWith","host","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","onerror","onunhandledrejection","onfocus","isMobile","onselectstart","oncontextmenu","startWait","userPassword","ret","userName","password","userApi","pwd","logindUser","notLogined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","alert","showPage","isUserLogin","onLogined","roles","me","icon","nick","callback","logoutApis","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","date","getTime","toTimeString","step","href","indexOf","text","parser","DOMParser","htmlDoc","parseFromString","elHtml","newVersion","red","lastBuildTime","saveSrcTsFileIfNotExists","context","fileName","suffix","saveTsFileIfNotExists","uqTsSrcPath","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","path","tsFilePath","buildTsHeader","entityName","getNameFromUq","uqMan","devPart","uqPart","config","dev","alias","devName","uqOwner","uqName","decodeGuestToken","CenterApiBase","Caller","_params","method","Page","observer","tabsView","tabsProps","TabsView","webNav","right","headerClassName","afterBack","inWebNav","pageHeaderProps","center","rph","renderPageHeader","footer","elFooter","errorInfo","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","ListPage","listPageProps","renderPage","pageItems","itemClick","renderItem","renderItemContainer","bottom","render","e","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","items","CList","midList","selectedItem","setRes","onItemClick","renderRight","first","firstParam","page","openPage","returnCall","onRightClick","listRight","Controller","MidList","renderTop","renderBottom","createPageItems","Mid","MidIDListBase","IDListPageItems","pageStart","pageSize","loadPageItems","_items","itemId","data","newItem","unshift","runInAction","assign","ListPageItems","t","str","internalT","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","beforeInit","getPageWebNav","afterInit","$lang","$district","l","timeZone","vp","param","open","replaceOpen","value","onEvent","registerReceiveHandler","beforeStart","internalStart","afterStart","onClosePage","go","caption","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","imageClassName","textClassName","renderUser","src","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","replacePageElement","ln","chars","codeBackSlash","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","arr","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","stringify","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","result","buildFieldsParams","arrResult","pa","rowResult","field","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","row","ch","substring","escape","values","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","n","isNaN","p0","vals","pageLoader","$page","PageItems","HistoryPageItems","far","near","TimeSpan","firstNear","dayValues","days","getDayArray","dv","day","setMinutes","getMinutes","getTimezoneOffset","span","DaySpan","WeekSpan","MonthSpan","YearSpan","_labels","setHours","toLocaleDateString","enWeek","zhWeek","firstDay","lastDay","getDay","setDate","initFromDate","year","month","count","setMonth","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","newValue","isChanged","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","formRes","required","number","integer","min","max","zh","listRes","none","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","headers","h","encodeURI","body","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","startsWith","buildHeaders","CenterHttpChannel","u","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","logoutUqTokens","UqApi","basePath","showWaiting","buildAppUq","channelUI","uqToken","getUqToken","trim","theUser","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","getUrlOrTest","centerChannel","centerChannelUI","centerToken","loginedUserId","uqTokensName","uqTokenApi","un","localCache","nowTick","clone","uqParams","callCenterapi","call","appOwner","appName","uqs","decodeUserToken","account","verify","VFormView","onSubmit","setDisabled","submit","uiSchema","fieldLabelSize","formData","onButtonClick","CFormView","formUI","submitCaption","buildItemSchema","buildUISchema","ID","noField","NO","readOnly","defaultValue","uiField","isKey","fieldItem","uiButton","pickId","uiNumber","placeholder","VFormPage","renderForm","CFormPage","openVPage","VDialog","CFormDialog","FormUI","fieldCustoms","fieldCustom","idField","createPickId","proxy","fieldNames","splice","onChanged","onChanging","UqQuery","more","startField","isPaged","size","array","deep","pageCaller","request","queryCaller","query","table","Query","CIDSelect","midIDSelectList","MidIDSelectList","onChange","defaultChecked","renderSelectItem","evt","onSelectChange","currentTarget","checked","$in","IDX","CIXSelect","MidIXSelectList","IX","IDinIX","mid","cIDSelect","CIDSelectInPickId","isSelected","ALPHABET","uid","rtn","charAt","random","uqTokens","parent","subFrameStarted","subWin","setSubAppWindow","hash","hidden","hideFrameBack","initSubWin","onReceiveAppApiMessage","apiName","onAppApiReturn","action","uqTokenActions","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","at","opener","brideCenterApis","callId","from","directCall","bca","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","target","sh","scrollHeight","direct","Children","_$scroll","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","resLang","languages","toUpperCase","setResOptions","resGlobal","setGlobalRes","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","b","badge","color","badgeAlign","badgeVertical","cn","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","__ls","getItem","setItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","saveIndex","ls","TuidContent","tuidName","uqStringify","ReactBoxId","isUndefined","valueFromId","boxName","assureBox","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","pl","search","decode","decodeURIComponent","match","exec","sUnit","tc","tt","from62","parseInt","isInteger","RegExp","initEnv","detectBrowser","tag","ms","args","global","handle","documentMode","importCLogin","CLogin","importCRegister","CRegister","CForget","IDXEntity","create","update","owner","VEdit","editHeader","cFormView","VContent","midID","itemHeader","renderViewRight","V","rows","VViewRight","onItemEdit","$zh","new","$en","CID","cList","midIDList","valueChanged","renderListRight","renderListTop","renderListBottom","saveID","onItemView","createFormView","onItemNew","setNO","createMidIDList","createCList","IDUI","itemProps","renderView","MidIDList","listPageItems","MidID","listHeader","_uiSchema","_props","Acts","buildGridProps","getHttpChannel","callFetch","put","delete","UQsMan","tvs","uqMans","collection","buildTVs","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","load","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","_uqs","buildUQs","uqTVs","lj","uqsData","promiseInits","uqData","uqAlias","uqFullName","UqMan","lower","loadEntities","uqKey","getUqKey","createProxy","Proxy","receiver","showReload","tuidArr","isImport","setInner","tuidImport","fromName","iName","setFrom","appConfig","app","loadUqs","tonvaAppName","uqsMan","UQsManApp","localData","uqAppData","loadAppUqs","buildUqs","getRoles","appUqs","CIXList","midIXList","MidIXList","ix","xi","MidIX","CIX","midIX","idList","CIXEdit","cIXList","onListRightClick","cSelect","idItem","ImageItemEdit","resId","onSaved","mobileRegex","emailRegex","itemObservable","loading","beforeLoad","loaded","allLoaded","topDiv","bottomDiv","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","scrollToBottom","firstSize","appendPosition","sortOrder","changing","computed","divId","getPageId","loadResults","pageList","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","setLoaded","onLoad","setPageStart","onLoaded","reverse","digits","c0","c9","A","Z","z","NaN","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","_getRoot","_historyUpdate","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","manageHooks","_callLeave","isHashedRoot","m","slice","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","preventDefault","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","names","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","after","onBack","vBack","debugLogout","role","rightView","Tab","selected","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","sep","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","displayNone","pageHeader","pageFooter","tabBack","display","ResUploader","fileInput","upload","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","formatSize","pointLength","units","shift","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","pos","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","height","w","scale","round","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","disabled","levelDiv","padding","fileSize","uploading","AudioUploader","audioTypes","createBoxId","enums","actions","queries","ids","idxs","ixs","sheets","books","maps","histories","pendings","tags","tuidsCache","localEntities","localModifyMax","tuids","createBoxIdFromTVs","allRoles","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","tagArr","apiParam","tv","prototype","retArr","retActs","ActIX","IXs","ActIXSort","ActDetail","master","detail","detail2","detail3","postParam","toScalars","QueryID","IDXToString","IDNO","IDDetailGet","KeyID","IX1","IXr","KeyIX","IDLog","IDSum","IDxID","ID2","IDTree","TuidsCache","centerApi","sheet","access","buildTuids","buildAccess","newTuid","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","setEntity","TuidImport","TuidInner","book","Book","Map","Tag","History","pending","Pending","Sheet","lName","idEntity","idx","newID","newIDX","newIX","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","ownerField","buildTuidDivBox","modifyMax","lk","states","ops","op","discription","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","setUI","$Piecewise","$PiecewiseDetail","AccountType","Account","AccountCTO","UserAccountType","VErrorsPage","errors","VStartError","CAppBase","onNavRoutes","afterBuiltUQs","resolveRoute","userFromId","userRoles","getUqUserRoles","setUqRoles","isRole","CApp","html","cApp","CBase","_cApp","getUqRoles","wn","getWebNav","CSub","_owner","ownerWNs","own","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderCheck","wrapClassName","inputs","inputName","onInputChange","input","coll","_view","lines","line","ext","buildFieldItem","$FieldItemType","fieldItemType","VLogout","onLogout","maxLength","VLogin","onLogin","username","form","sender","getSender","onEnter","tonvaTop","requiredFlag","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","setError","userLogined","vPage","getVChangePassword","changePassword","logo","senders","regex","timeRes","md","ymd","yesterday","today","tomorrow","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","appendTime","dPart","hm","EasyTime","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","group","queue","modify","modifyIds","importSelect","setIDUi","exFields","noFieldItem","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","Widget","fieldProps","_ui","contextErrors","visible","isChanging","changeValue","container","inNode","FieldContainer","renderBody","hasError","getUiItem","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","prev","allowChange","setDataValue","setElementValue","fieldClass","FieldClass","elDiscription","discriptionClassName","uiLabel","errorList","TextWidget","inputType","hasFocus","onKeyDown","internalOnKeyDown","keyCode","blur","onBlur","checkRules","checkContextRules","onFocus","clearErrors","renderTemplet","renderErrors","TextAreaWidget","setValue","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","observerRender","widgetType","button","ButtonClass","Context","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","end","TagWidget","stringWidget","widgetFactories","string","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","hiden","widgetFactory","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelAlign","labelView","cnAlign","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","preValue","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","MidIDXList","week","midIDX","renderStringProp","renderNumberProp","spanValues","VEditNumberField","dateInput","timeInput","onValueChange","valueAsDate","dateTicks","valueAsNumber","timeTicks","saveFieldValue","vDateTime","defDate","VHistory","historyItems","VHistoryPage","renderVm","spans","graphOptions","maintainAspectRatio","VView","currentIndex","timeSpan","prevTimeSpan","nextTimeSpan","labels","datasets","toJS","backgroundColor","borderWidth","curProp","moveStep","spanStep","canNext","borderBottomStyle","borderBottomColor","onFieldHistory","sv","onFieldClick","setTimeSpan","showFieldHistory","setCurrentField","CIDX","historyPageItems","loadSum","next","historyLoader","midIDXList","sums","loadDayValues","startFieldHistory","getDayValues","loadFieldSum","MidIDX","$time","retSum","valueFields","VSelect","tagGroups","midTag","typeColl","itemTags","typeArr","midType","checks","tagGroup","sub","tagId","renderType","onTagSelectChanged","CSelect","cIDTagList","defaultRenderTags","ItemTagsListPageItems","VTags","allTags","checkInputs","showID","CShowTagIDList","MidTagIDList","VRoles","onRoleAdmin","showRoleAdmin","onAccountant","onManager","roleItems","$","accountant","manager","renderRoleItem","VAddUser","newUser","VRoleAdmin","userRole","rightIcon","roleCaptions","ixOfUsers","vUser","restoreUser","deleteUser","vCap","onRoleChange","ixUserBind","VItem","VUserRoles","MeItem","meRoles","iRole","setUserRole","CRoleAdmin","myRolesChanged","roleCaptionMap","ixName","getIX","id2Name","getID","cIXEdit","getAllRoleUsers","allUserRoles","rolesBool","meId","ur","setUserRoles","fireMyRolesChanged","newRoles","roleNames","userFromKey","buildRolesText","deleteUserRoles","ListBase","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","userSetProp","IdCache","tuidLocal","localArr","waitingIds","tuidInner","initLocalArr","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","loadingIds","netIds","loadTuidIds","netRet","IdDivCache","divName","Tuid","noCache","typeName","idName","unique","TuidBox","id1","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","hasDiv","loadMain","save","saveProp","loadArr","saveArr","posArr","TuidBoxDiv","buildTsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","buildUQ","saveTsIndexAndRender","imports","sets","cName","tsUI","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","begin","tsIndex","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","fieldsText","buildFieldsFromOldText","fieldItemReplaceProps","oldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildEnumInterface","buildTuidInterface","buildActionInterface","buildSheetInterface","buildQueryInterface","buildBookInterface","buildMapInterface","buildHistoryInterface","buildPendingInterface","buildTagInterface","buildIDInterface","buildIDXInterface","buildIDXActParamInterface","buildIXInterface","sName","buildActsInterface","uqBlock","buildTuid","buildAction","buildBook","buildQuery","buildMap","buildHistory","buildPending","buildTag","buildID","buildIDX","buildIX","buildInterface","entityCode","isInID","indent","buildField","fieldTypeMap","sysFields","q","repeat","buildArrs","af","buildReturns","retName","schemaKeys","others","hasTrack","hasMemo","exField","track","memo","mul","offset","asc","$owner","commissionFormula","orderAmount","orderDeliver","orderPaid","amount","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","CUqBase","CUqSub","CUqApp","VValuePage","CContentManager","cHome","orderAmountDay","orderAmountWeek","orderAmountMonth","renderOrderAmount","vAmount","allValuesLoaded","renderAmount","renderCaption","showIDX","CCTO","JkMe","cIDX","showItemView","loadItem","timeSpanDay","timeSpanWeek","timeSpanMonth","accountId","VHome","renderAccountType","accountController","onClickAccountType","accountControllers","CHome","keyx","accounType","newSub","noUnit","VAbout","VMe","meInfo","showEditMe","userSpan","about","aboutRows","VEditMe","onExit","gridRows","CMe","unitOwner","rootUnits","backend","testTimesChange","debugItems","VBug","openDebugPage","VConsole","divBottom","autoScrollEnd","autoScroll","lastScrollTop","timeHandler","createRange","selectNode","objToHtml","createContextualFragment","appendChild","startAutoScrollToBottom","currentItem","pauseAutoScrollToBottom","arrToHtml","objToString","indentVal","objToLine","CBug","home","relation","discover","debug","aboutTheApp","pleaseLogin","VMain","cMe","VTester","click","uiItems","CTester","cBug","cUI","timer","newC","App","setSettings","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.92626f19.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\nexport * from './res';\r\nexport * from './ui';\r\n","\r\nconst zero = '00000000000000';\r\nexport function left0(num:number, fix:number) {\r\n    if (num === undefined) return '';\r\n    let r = num.toString();\r\n    let len = fix - r.length;\r\n    if (len <= 0) return r;\r\n    return zero.substr(0, len) + r;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from '../tool/rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import * as React from 'react';\r\nimport {makeObservable, observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, host, resUrlFromHost, messageHub} from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { createLogin, Login, showForget, showRegister } from './login';\r\n\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n\tuserPassword?: () => Promise<{user:string; password:string}>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n\tnotSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n\t\tlet {browser} = env;\r\n\t\tlet notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n\t\t\tnotSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\tif (this.state.notSupportedBrowser === true) return;\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\tawait nav.init();\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {notSupportedBrowser, wait, fetchError} = this.state;\r\n\t\tif (notSupportedBrowser === true) {\r\n\t\t\treturn <div className=\"p-3 text-danger\">\r\n\t\t\t\t{env.browser} not supported !\r\n\t\t\t</div>;\r\n\t\t}\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n\t\t\t++top;\r\n\t\t}\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\tnavSettings: NavSettings;\r\n    user: User = null;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tuser: observable,\r\n\t\t});\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n\t\tlet {htmlTitle} = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = nav.user;\r\n\t\tif (user === undefined && curUser === undefined) return;\r\n\t\tif (user && curUser && user.id === curUser.id) return;\r\n\t\tif (!user) nav.logout();\r\n\t\telse nav.logined(user)\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n\t\t\twindow.onfocus = this.reloadUser;\r\n            if (env.isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\t//nav.onSysNavRoutes();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {userPassword} = this.navView.props;\r\n\t\t\t\tif (userPassword) {\r\n\t\t\t\t\tlet ret = await userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet {user:userName, password} = ret;\r\n\t\t\t\t\t\tlet logindUser = await userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: nav.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\tlet {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (notLogined !== undefined) {\r\n\t\t\t\t\t\tawait notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tnav.navigate('/login');\r\n\t}\r\n\r\n\topenSysPage(url: string):boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n\tsetUqRoles(uq:string, roles:string[]) {\r\n\t\tlet {roles:userRoles} = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else if (this.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n\t}\r\n\r\n\tonChangeLogin: (user:User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n        //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: ()=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin();\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tshowRegister();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tshowForget();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        //appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\t//this.ws = undefined;\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n\t}\r\n\t/*\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()}/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n\t}\r\n\t*/\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n\t\t\t\t<main className=\"va-error p-3\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-primary mr-3\" type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { BuildContext } from './context';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:BuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:BuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\n\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { List, Page, PageItems, Scroller } from \"tonva-react\";\r\n\r\nexport interface ListPageProps {\r\n\tpageItems: PageItems<any>;\r\n\titemClick: (item:any) => any;\r\n\trenderItem?: (item:any, index:number) => JSX.Element;\r\n\trenderItemContainer?: (content:any) => JSX.Element;\r\n\tkey: (item:any) => number|string;\r\n\theader: JSX.Element | string;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\ttop?: JSX.Element;\r\n\tbottom?: JSX.Element;\r\n\tback?: 'close' | 'back' | 'none';\r\n\tclassName?: string;\r\n\theaderClassName?: string;\r\n}\r\n\r\nexport class ListPage extends Page {\r\n\tprotected listPageProps: ListPageProps;\r\n\tconstructor(listPageProps: ListPageProps) {\r\n\t\tsuper({});\r\n\t\tthis.listPageProps = listPageProps;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tprivate renderPage():JSX.Element {\r\n\t\tlet {pageItems, itemClick, renderItem, renderItemContainer\r\n\t\t\t, key, header, footer, right\r\n\t\t\t, top, bottom, back, className, headerClassName} = this.listPageProps;\r\n\t\tif (!header) header = false as any;\r\n\t\tlet renderRow = (item:any, index:number) => {\r\n\t\t\treturn renderItemContainer(renderItem(item, index));\r\n\t\t}\r\n\t\tlet item = {\r\n\t\t\trender: renderRow,\r\n\t\t\tonClick: itemClick,\r\n\t\t\tkey,\r\n\t\t}\r\n\t\treturn <Page\r\n\t\t\theader={header} right={right} footer={footer}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={back}\r\n\t\t\theaderClassName={headerClassName}\r\n\t\t\tclassName={className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t>\r\n\t\t\t{top}\r\n\t\t\t<List items={pageItems} item={item} />\r\n\t\t\t{bottom}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { renderItem, listRight, renderItemContainer } from \"../tools\";\r\nimport { ListPage, ListPageProps } from \"./ListPage\";\r\nimport { MidList } from \"./MidList\";\r\n\r\nexport class CList<T> extends Controller {\r\n\tprotected readonly midList: MidList<T>;\r\n\tprotected selectedItem: T;\r\n\tprotected listPageProps: ListPageProps;\r\n\tconstructor(midList: MidList<T>) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midList.res);\r\n\t\tthis.midList = midList;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.midList.init();\r\n\t\tlet pageItems = this.midList.pageItems;\r\n\t\tlet props:ListPageProps = {\r\n\t\t\theader: this.header,\r\n\t\t\tpageItems,\r\n\t\t\tkey: this.midList.key,\r\n\t\t\titemClick: (item:any) => this.onItemClick(item),\r\n\t\t\tright: this.renderRight(),\r\n\t\t\trenderItem: (item:any, index) => this.renderItem(item, index),\r\n\t\t\trenderItemContainer: (content:any) => this.renderItemContainer(content),\r\n\t\t};\r\n\t\tpageItems.first(this.firstParam);\r\n\t\tthis.listPageProps = props;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.init();\r\n\t\tlet page = new ListPage(this.listPageProps);\r\n\t\tthis.openPage(page.render(), () => this.returnCall(this.selectedItem));\r\n\t}\r\n\r\n\tprotected get firstParam():any {return undefined;}\r\n\tprotected get header():string|JSX.Element {return this.midList.header ?? 'List'}\r\n\tprotected renderItemContainer(content:any):JSX.Element {\r\n\t\treturn renderItemContainer(content);\r\n\t}\r\n\tprotected onItemClick(item:any):void {\r\n\t\tthis.midList.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\t\t\r\n\t\tlet {renderRight, onRightClick} = this.midList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\treturn (this.midList.renderItem ?? renderItem)(item, index);\r\n\t}\r\n\r\n}\r\n","import { runInAction } from \"mobx\";\r\nimport { PageItems, Uq } from \"tonva-react\";\r\nimport { ListPageItems } from \"../tools\";\r\nimport { IDBase, Mid } from \"../base\";\r\n\r\nexport abstract class MidList<T> extends Mid {\r\n\treadonly pageItems: PageItems<T>;\r\n\tconstructor(uq:Uq, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.pageItems = this.createPageItems();\r\n\t}\r\n\r\n\tprotected abstract createPageItems():PageItems<T>;\r\n\tasync init():Promise<void> {}\r\n\tprotected abstract loadPageItems(pageStart:any, pageSize:number):Promise<T[]>;\r\n\tkey:((item:T) => number|string);\r\n\r\n\tonRightClick: ()=>any;\r\n\trenderItem: (item:T, index:number)=>JSX.Element;\r\n\tonItemClick: (item:T)=>any;\r\n\trenderRight: ()=>JSX.Element;\r\n\theader: string|JSX.Element;\r\n\trenderTop: () => JSX.Element;\r\n\trenderBottom: () => JSX.Element;\r\n}\r\n\r\nexport abstract class MidIDListBase<T extends IDBase> extends MidList<T> {\r\n\tprotected get listPageItems(): IDListPageItems<T> {return this.pageItems as IDListPageItems<T>}\r\n\tkey:((item:T) => number|string) = item => {\r\n\t\treturn item.id;\r\n\t}\r\n\tcreatePageItems():PageItems<T> {\r\n\t\tlet loader = (pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize);\r\n\t\treturn new IDListPageItems<T>(loader);\r\n\t}\r\n}\r\n\r\nexport class IDListPageItems<T extends IDBase> extends ListPageItems<T> {\r\n\titemId(item:T):number {return item.id}\r\n\tnewItem(id:number, item:T):T {return {...item, id}}\r\n\r\n\tupdate(item:T): Promise<void> {\r\n\t\tlet id = item.id;\r\n\t\tlet ret = this._items.find(v => this.itemId(v) === id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tlet data = this.newItem(id, item);\r\n\t\t\tthis._items.unshift(data);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trunInAction(() => {\r\n\t\t\t\tObject.assign(ret, item);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav, Page, PageHeaderProps, PageWebNav} from '../components';\r\nimport {resOptions, t} from '../res';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n\tprotected res: any = {};\r\n\tt = (str: string): string|JSX.Element => this.internalT(str) || str;\r\n    icon: string|JSX.Element;\r\n    label:string|JSX.Element;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n\tinit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this.res?.[str] ?? t(str);\r\n\t}\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tgetPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tget isWebNav(): boolean {return nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tnav.navigate(url);\r\n\t}\r\n\t\r\n\tsetRes(res: any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this.res, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this.res, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this.res, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\tgetRes():any {return this.res;}\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tmessageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n\tget timeZone():number { return env.timeZone; }\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.open(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.replaceOpen(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C)=>V, param?:any):JSX.Element {\r\n\t\tlet v = new view((this as any) as C);\r\n\t\treturn v.render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.controller.isWebNav}\r\n\tnavigate(url:string) {this.controller.navigate(url)}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n\tfields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n\t\tthis.fields = fields;\r\n        this.uq.buildFieldTuid(fields);\r\n\t\tthis.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n\t\tthis.returns = returns;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { PageItems } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\n\r\nexport type IDItemsPageLoader<T> = (pageStart:any, pageSize:number) => Promise<T[]>;\r\nexport type HistoryPageLoader<T> = (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number) => Promise<T[]>;\r\n\r\nexport abstract class ListPageItems<T> extends PageItems<T> {\r\n\tprivate pageLoader: IDItemsPageLoader<T>;\r\n\tconstructor(pageLoader: IDItemsPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.pageLoader(pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tabstract update(item: T): Promise<void>;\r\n}\r\n\r\nexport class HistoryPageItems<T extends IDBase> extends PageItems<T> {\r\n\tprivate pageLoader: HistoryPageLoader<T>;\r\n\tconstructor(pageLoader: HistoryPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet {id, field, far, near} = param;\r\n\t\tlet ret = await this.pageLoader(id, field, far, near, pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tupdate(item: T): Promise<void> {return;}\r\n}\r\n","import { env } from \"tonva-react\";\r\n\r\nexport abstract class TimeSpan {\r\n\tstatic create(span: 'day' | 'week' | 'month' | 'year'):TimeSpan {\r\n\t\tlet ret:TimeSpan;\r\n\t\tswitch (span) {\r\n\t\t\tcase 'day': ret = new DaySpan(); break;\r\n\t\t\tcase 'week': ret = new WeekSpan(); break;\r\n\t\t\tcase 'month': ret = new MonthSpan(); break;\r\n\t\t\tcase 'year': ret = new YearSpan(); break;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\tprotected firstNear: number;\r\n\tfar: number;\r\n\tnear: number;\r\n\ttype: string;\r\n\r\n\tabstract prev():void;\r\n\tabstract next():void;\r\n\tabstract get title():string;\r\n\tabstract get labels():string[];\r\n\tprotected abstract getDayArray(): Date[];\r\n\r\n\tget canNext():boolean {\r\n\t\treturn this.near < this.firstNear;\r\n\t}\r\n\tget canPrev():boolean {return true;}\r\n\r\n\tgetDayValues(dayValues:{t:string;v:number}[]): number[] {\r\n\t\tlet days = this.getDayArray();\r\n\t\tlet ret:number[] = [];\r\n\t\tlet i = 0;\r\n\t\tlet dv = dayValues[i++];\r\n\t\tfor (let day of days) {\r\n\t\t\tif (dv) {\r\n\t\t\t\tlet {t, v} = dv;\r\n\t\t\t\tlet d = new Date(t);\r\n\t\t\t\td.setMinutes(d.getMinutes() + d.getTimezoneOffset());\r\n\t\t\t\tif (d.getTime() === day.getTime()) {\r\n\t\t\t\t\tret.push(v);\r\n\t\t\t\t\tdv = dayValues[i++];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tret.push(0);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass DaySpan extends TimeSpan {\r\n\tprivate date: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'day';\r\n\t\tthis.date = new Date();\r\n\t\tthis.date.setHours(0, 0, 0, 0);\r\n\t\tthis.far = this.date.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 24 * 3600 * 1000;\r\n\t\tfor (let i=0; i<24; i++) this._labels.push(i + ':00');\r\n\t}\r\n\tprev():void {\r\n\t\tthis.far -= 24 * 3600 * 1000;\r\n\t\tthis.near -= 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.far += 24 * 3600 * 1000;\r\n\t\tthis.near += 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.date.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {return [this.date]};\r\n}\r\n\r\n\r\nconst enWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\r\nconst zhWeek = ['一', '二', '三', '四', '五', '六', '日', ];\r\nclass WeekSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'week';\r\n\t\tthis.firstDay = new Date();\r\n\t\tthis.firstDay.setHours(0, 0, 0, 0);\r\n\t\tlet day = this.firstDay.getDay() || 7; // Get current day number, converting Sun. to 7\r\n\t\tif (day !== 1) {                // Only manipulate the date if it isn't Mon.\r\n\t\t\tthis.firstDay.setHours(-24 * (day - 1));   // Set the hours to day number minus 1\r\n\t\t}\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 7 * 24 * 3600 * 1000;\r\n\t\tthis.lastDay = new Date();\r\n\t\tthis.lastDay.setDate(this.firstDay.getDate()+7);\r\n\t\tswitch (env.lang) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'en': this._labels = enWeek; break;\r\n\t\t\tcase 'zh': this._labels = zhWeek; break;\r\n\t\t}\r\n\t}\r\n\tprev():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()-7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()-7);\r\n\t\tthis.far -= 7 * 24 * 3600 * 1000;\r\n\t\tthis.near -= 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()+7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()+7);\r\n\t\tthis.far += 7 * 24 * 3600 * 1000;\r\n\t\tthis.near += 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass MonthSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'month';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = date.getMonth();\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t\tthis._labels = [];\r\n\t\tlet count = this.lastDay.getDate();\r\n\t\tfor (let i=1; i<=count; i++) this._labels.push(String(i));\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass YearSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'year';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t\tfor (let i=0; i<=12; i++) this._labels.push(String(i));\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = 0;\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { FA } from \"tonva-react\";\r\n\r\nexport function listRight(onClick: () => any): JSX.Element {\r\n\treturn <button className=\"btn btn-sm btn-success mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>\r\n}\r\n\r\nexport function renderItem(item:any, index:number) {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n}\r\n\r\nexport function renderItemContainer(content:any) {\r\n\treturn <div className=\"px-3 py-2\">\r\n\t\t{content}\r\n\t</div>;\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string|JSX.Element;\r\n\tget editInRow(): boolean {return false;}\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terror: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t});\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string|JSX.Element, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","export * from './Mid';\r\nexport * from './IDBase';\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    //private access:string[];\r\n    //appOwner:string;\r\n    //appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, /*appOwner:string, appName:string, */uqOwner:string, uqName:string/*, access:string[]*/, showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        //this.appOwner = appOwner;\r\n        //this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        //this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = getUqToken(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n\t\t//let ret = await this.get('access', {acc:acc});\r\n\t\tlet ret = await this.get('entities');\r\n        return ret;\r\n\t}\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', /*undefined, undefined, */undefined, undefined/*, undefined*/, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let uqParams:any = _.clone(params);\r\n            uqParams.testing = host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n\townerAlias: string;\r\n    uqName: string;\r\n\tuqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner, appName});\r\n        return ret;\r\n    }\r\n    async uqs(uqs: {owner:string; name:string; version:string}[]):Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","import { Context, Form, View } from \"tonva-react\";\r\nimport { CFormView } from \"./CFormView\";\r\n\r\nexport class VFormView<C extends CFormView<any>> extends View<C> {\r\n\trender(param: any) {\r\n\t\tlet {schema, uiSchema} = this.controller;\r\n\t\treturn <Form fieldLabelSize={2} formData={param}\r\n\t\t\tschema={schema}\r\n\t\t\tuiSchema={uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit} />\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tcontext.setDisabled(name, true);\r\n\t\tawait this.controller.submit(name, context);\r\n\t\tcontext.setDisabled(name, false);\r\n\t}\r\n}","import { ButtonSchema, Context, Controller, FieldItem, FieldItems, FieldItemString, ID, Schema, UI, UiButton, UiIdItem, UiNumberItem, UiSchema } from \"tonva-react\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormView } from \"./VFormView\";\r\n\r\nexport class CFormView<T> extends Controller {\r\n\tprotected readonly ui: UI;\r\n\tschema: Schema;\r\n\tuiSchema: UiSchema;\r\n\tlabel: string|JSX.Element;\r\n\tsubmitCaption: string|JSX.Element;\r\n\tonSubmit: (name:string, context: Context) => Promise<void>;\r\n\r\n\tconstructor(formUI: FormUI) {\r\n\t\tsuper();\r\n\t\tlet {label, fieldArr, fields, submitCaption, t} = formUI;\r\n\t\tthis.t = t;\r\n\t\tthis.schema = this.buildItemSchema(fieldArr);\r\n\t\tthis.uiSchema = this.buildUISchema(fields);\r\n\t\tthis.label = t(label);\r\n\t\tthis.submitCaption = t(submitCaption);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync setNO(ID: ID, fieldName:string = 'no') {\r\n\t\tlet field = this.schema.find(v => v.name === fieldName);\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t\tlet uiField = this.uiSchema.items[fieldName];\r\n\t\tif (uiField) {\r\n\t\t\tuiField.readOnly = true;\r\n\t\t\tuiField.defaultValue = no;\r\n\t\t}\r\n\t}\r\n\r\n\tasync submit(name:string, context: Context) {\r\n\t\tawait this.onSubmit?.(name, context);\r\n\t}\r\n\r\n\tprotected buildItemSchema(fieldArr: FieldItems): Schema {\r\n\t\tlet ret:Schema = [];\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(fields: {[name:string]:FieldItem}):UiSchema {\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: this.submitCaption ?? '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet {type} = field;\r\n\t\t\tif (type === 'id') {\r\n\t\t\t\tlet uiId = field as UiIdItem;\r\n\t\t\t\tlet {pickId} = uiId;\r\n\t\t\t\tif (pickId === undefined) {\r\n\t\t\t\t\tlet uiNumber = field as UiNumberItem;\r\n\t\t\t\t\tuiNumber.widget = 'number';\r\n\t\t\t\t\tuiNumber.placeholder = 'ID number, only on debugging';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\trenderForm(item:T):JSX.Element {\r\n\t\tlet v = new VFormView(this);\r\n\t\treturn v.render(item);\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CFormPage } from \"./CFormPage\";\r\n\r\nexport class VFormPage<C extends CFormPage<any>> extends VPage<C> {\r\n\theader() {return this.controller.label}\r\n\tprotected get back(): 'close' | 'back' | 'none' {\r\n\t\treturn 'close';\r\n\t}\r\n\t\r\n\tcontent() {\r\n\t\t/*let {param, schema, uiSchema} = this.controller;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form fieldLabelSize={2} formData={param}\r\n\t\t\t\tschema={schema}\r\n\t\t\t\tuiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onSubmit} />\r\n\t\t</div>*/\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{this.controller.renderForm(this.controller.item)}\r\n\t\t</div>;\r\n\t}\r\n\t/*\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tthis.controller.submit(context.data);\r\n\t}\r\n\t*/\r\n}\r\n","import { CFormView } from \"./CFormView\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class CFormPage<T> extends CFormView<T> {\r\n\titem: T;\r\n\tconstructor(formUI: FormUI, item: T) {\r\n\t\tsuper(formUI);\r\n\t\tthis.item = item;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage<any, any>(VFormPage);\r\n\t}\r\n}\r\n","import { CFormDialog } from \"./CFormDialog\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class VDialog extends VFormPage<CFormDialog<any>> {\r\n\tprotected afterBack():void {\r\n\t\tthis.controller.close();\r\n\t}\r\n}\r\n","import { CFormPage } from \"./CFormPage\";\r\nimport { VDialog } from \"./VDialog\";\r\n\r\nexport class CFormDialog<T> extends CFormPage<T> {\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VDialog)\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis.returnCall(null);\r\n\t}\r\n\r\n\tasync submit(data:any) {\r\n\t\tlet item: any;\r\n\t\tif (!this.item) item = this.item;\r\n\t\telse item = {};\r\n\t\tObject.assign(item, data);\r\n\t\tthis.returnCall(item);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { ChangedHandler, ChangingHandler, FieldCustoms, FieldItem, FieldItemId, FieldItemString, ID, PickId, TFunc, UI } from \"tonva-react\";\r\nimport { createPickId } from '../select';\r\n\r\nexport class FormUI {\r\n\tlabel: string|JSX.Element;\r\n\treadonly fieldArr: FieldItem[];\r\n\treadonly fields: {[name:string]: FieldItem};\r\n\tsubmitCaption: string;\r\n\tt: TFunc;\r\n\r\n\tconstructor(ui: UI, fieldCustoms:FieldCustoms, t?: TFunc) {\r\n\t\tthis.t = t ?? ((str:string|JSX.Element) => str);\r\n\t\tlet {label, fieldArr, fields} = ui;\r\n\t\tthis.label = label;\r\n\t\tthis.fieldArr = [];\r\n\t\tthis.fields = {};\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet fieldCustom = fieldCustoms?.[i];\r\n\t\t\tlet index = fieldArr.findIndex(v => v === field);\r\n\t\t\tlet f:FieldItem;\r\n\t\t\tif (fieldCustom) {\r\n\t\t\t\tlet label = this.t(fieldCustom.label ?? field.label);\r\n\t\t\t\tf = {...field, ...fieldCustom, label};\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tlet idField = f as FieldItemId;\r\n\t\t\t\t\tidField.widget = 'id';\r\n\t\t\t\t\tidField.pickId = createPickId(ID.uq.proxy, ID);\r\n\t\t\t\t\t(idField as any).Templet = ID.render;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet label = this.t(field.label);\r\n\t\t\t\tf = {...field, label};\r\n\t\t\t}\r\n\t\t\tthis.fields[i] = f;\r\n\t\t\tthis.fieldArr[index] = f;\r\n\t\t}\r\n\t\t/*\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tthis.setIDUi(i, createPickId(ID.uq.proxy, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\tsetIDUi(fieldName:string, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field === undefined) {\r\n\t\t\talert(`${fieldName} not defined in UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (field.type !== 'id') {\r\n\t\t\talert(`${fieldName} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = field as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tasync setNO(ID:ID, fieldName:string = 'no'):Promise<void> {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n\thideField(...fieldNames:string[]) {\r\n\t\tfor (let fieldName of fieldNames) {\r\n\t\t\tlet index = this.fieldArr.findIndex(v => v.name === fieldName);\r\n\t\t\tif (index >= 0) this.fieldArr.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tsetFieldChanged(fieldName: string, onChanged: ChangedHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanged = onChanged;\r\n\t}\r\n\r\n\tsetFieldChanging(fieldName: string, onChanging: ChangingHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanging = onChanging;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n\t/*\r\n\tconstructor(uq:UqMan, name:string, typeId:number) {\r\n\t\tsuper(uq, name, typeId);\r\n\t\tmakeObservable(this, {\r\n\t\t\tlist: observable,\r\n\t\t})\r\n\t}\r\n\t*/\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { ID, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base/IDBase\";\r\nimport { CList, IDListPageItems, MidList } from \"../list\";\r\nimport { renderSelectItem } from \"./parts\";\r\n\r\nexport class CIDSelect<T extends IDBase, P extends MidIDSelectList<T>> extends CList<T> {\r\n\tmidIDSelectList: P;\r\n\tconstructor(midIDSelectList: P) {\r\n\t\tsuper(midIDSelectList);\r\n\t\tthis.setRes(midIDSelectList.res);\r\n\t\tthis.midIDSelectList = midIDSelectList;\r\n\t}\r\n\r\n\tprotected createMidList(): MidList<T> {\r\n\t\treturn new MidIDSelectList(this.midIDSelectList.uq, this.midIDSelectList.ID);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\tlet onChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\t\tlet {onSelectChange} = this.midIDSelectList;\r\n\t\t\tonSelectChange?.(item, evt.currentTarget.checked);\r\n\t\t}\r\n\t\tlet {renderItem, ID} = this.midIDSelectList;\r\n\t\tlet content = (renderItem ?? ID.render)(item, index);\r\n\t\tlet {$in} = item;\r\n\t\treturn renderSelectItem(onChange, content, $in===1);\r\n\t}\r\n}\r\n\r\nexport class MidIDSelectList<T extends IDBase> extends MidList<T> {\r\n\treadonly ID:ID;\r\n\tonSelectChange: (item:T, isSelected:boolean)=>any;\r\n\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","export function renderSelectItem(\r\n\tonChange:(evt:React.ChangeEvent<HTMLInputElement>)=>void, \r\n\tcontent:any,\r\n\tdefaultChecked:boolean):JSX.Element {\r\n\treturn <label className=\"mx-3 my-2 d-flex mb-0\">\r\n\t\t<input type=\"checkbox\" onChange={onChange} className=\"mr-3\" defaultChecked={defaultChecked} />\r\n\t\t{content}\r\n\t</label>;\r\n}","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDListPageItems } from \"../list\";\r\nimport { IXBase } from \"../base\";\r\nimport { CIDSelect, MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport class CIXSelect<T extends IXBase> extends CIDSelect<T, MidIXSelectList<T>> {\r\n}\r\n\r\nexport class MidIXSelectList<T extends IXBase> extends MidIDSelectList<T> {\r\n\treadonly IX:IX;\r\n\treadonly id:number;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, id:number) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait super.init();\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IDinIX<T>({\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tid: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret as any[];\r\n\t}\r\n}\r\n","import { Context, ID, PickId, Uq } from \"tonva-react\";\r\nimport { CIDSelect,MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport function createPickId(uq: Uq, ID: ID): PickId {\r\n\tasync function pickId(context:Context, name: string, value: number):Promise<any> {\r\n\t\tlet mid: MidIDSelectList<any> = new MidIDSelectList(uq, ID);\r\n\t\tlet cIDSelect = new CIDSelectInPickId(mid);\r\n\t\tlet ret = await cIDSelect.call<any>();\r\n\t\treturn ret;\r\n\t}\r\n\treturn pickId;\r\n}\r\n\r\nexport class CIDSelectInPickId extends CIDSelect<any, MidIDSelectList<any>> {\r\n\tconstructor(mid: MidIDSelectList<any>) {\r\n\t\tsuper(mid);\r\n\t\tmid.onSelectChange = this.onSelectChange;\r\n\t}\r\n\r\n\tprivate onSelectChange = (item:any, isSelected:boolean) => {\r\n\t\tthis.selectedItem = item;\r\n\t\tthis.closePage();\r\n\t\t// closePage时，returnCall已经被调用了\r\n\t\t// this.returnCall(item);\r\n\t}\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\nimport { env } from '../tool';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n\tif (!message) return;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n\tlet {unit} = env;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n\t\t//let unit = getUnit();\r\n\t\tlet {unit} = env;\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            //hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function getUqToken(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t}\r\n\t\tlet testProd:string;\r\n        if (this.testing === true) {\r\n\t\t\tif (urlTest !== '-') url = urlTest;\r\n\t\t\ttestProd = 'test';\r\n        }\r\n        else {\r\n\t\t\ttestProd = 'prod';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet {unit, testing, params, lang, district, timeZone, isMobile} = initEnv();\r\n    return {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tparams,\r\n\t\tlang, \r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(), \r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n        localDb: new LocalMap(testing===true? '$$':'$'),\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number; \r\n\ttesting: boolean; \r\n\tparams: {[key:string]: string}; \r\n\tlang: string; \r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n}\r\n{\r\n\tlet pl     = /\\+/g,  // Regex for replacing addition symbol with a space\r\n        search = /([^&=]+)=?([^&]*)/g,\r\n        decode = function (s:any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n        query  = window.location.search.substring(1);\r\n    let params:{[key:string]:string} = {};\r\n    for (;;) {\r\n\t   let match = search.exec(query);\r\n\t   if (!match) break;\r\n       params[decode(match[1])] = decode(match[2]);\t\r\n\t}\r\n\r\n\tlet testing:boolean; // = isTesting();\r\n\tlet unit:number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\t\t\r\n\t\tif (p>=0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p+1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName:string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn {unit, testing, params, lang, district, timeZone, isMobile};\r\n}\r\n\r\nfunction detectBrowser() { \r\n    if((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0 )\r\n        return 'Opera';\r\n\tif(navigator.userAgent.indexOf(\"Chrome\") >= 0 )\r\n        return 'Chrome';\r\n\tif(navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n        return 'Safari';\r\n\tif(navigator.userAgent.indexOf(\"Firefox\") >= 0 )\r\n        return 'Firefox';\r\n\tif((navigator.userAgent.indexOf(\"MSIE\") >= 0 ) || (!!(document as any).documentMode === true ))\r\n        return 'IE'; //crap\r\n    return 'Unknown';\r\n}\r\n","import { User } from '../tool';\r\n\r\nexport interface Login {\r\n\tshowLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):void;\r\n\tshowLogout(callback?: ()=>Promise<void>):void\r\n\t//showRegister():void\r\n\t//showForget():void\r\n\tshowChangePassword():void\r\n}\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin();\r\n}\r\n\r\nexport async function showRegister():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister();\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget();\r\n\tc.start();\r\n}\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './build';\r\nexport * from './ID';\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import { TFunc } from \"../res\";\r\nimport { Entity } from \"./entity\";\r\nimport { Render, UI } from '../ui';\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport abstract class IDXEntity<M> extends Entity {\r\n\treadonly ui: UI;\r\n\treadonly render: Render<M>;\r\n\treadonly t: TFunc;\r\n}\r\n\r\nexport class UqID<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'id'}\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', {ID:this.name});\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nexport class ID extends UqID<any> {\t\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'idx'}\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'ix'}\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VEdit extends VPage<CID<any>> {\r\n\theader() {return  this.controller.editHeader}\r\n\tcontent() {\r\n\t\tlet {cFormView, item} = this.controller;\r\n\t\t//let {IDUI} = midID;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{cFormView.renderForm(item)}\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, PropGrid, View, VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VContent extends VPage<CID<any>> {\r\n\theader() {return this.controller.midID.itemHeader}\r\n\tright() {\r\n\t\treturn this.controller.renderViewRight();\r\n\t}\r\n\tcontent() {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {item, midID} = this.controller;\r\n\t\t\tlet {props} = midID;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<PropGrid rows={props}\r\n\t\t\t\t\tvalues={item} />\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nexport class VViewRight extends View<CID<any>> {\r\n\trender() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tnew: '新建',\r\n\tedit: '修改',\r\n\tlist: '列表',\r\n}","export const en = {\r\n\tnew: 'New',\r\n\tedit: 'Edit',\r\n\tlist: 'List',\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { renderItem } from \"../tools\";\r\nimport { IDBase } from \"../base\";\r\nimport { CList } from '../list';\r\nimport { CFormView, FormUI } from \"../form\";\r\nimport { MidID } from \"./MidID\";\r\nimport { MidIDList } from \"./MidIDList\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VContent, VViewRight } from \"./VContent\";\r\nimport { res } from \"./res\";\r\n\r\nexport class CID<T extends IDBase> extends Controller {\r\n\titem:T = null;\r\n\tmidID: MidID<T>;\r\n\tcFormView: CFormView<T>;\r\n\tprivate cList: CList<T>;\r\n\tprivate midIDList: MidIDList<T>;\r\n\tprivate valueChanged: boolean;\r\n\r\n\tconstructor(midID: MidID<T>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\titem: observable,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midID.res);\r\n\t\tthis.midID = midID;\r\n\t}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.midIDList =  this.midID.createMidIDList();\r\n\t\tthis.midIDList.onRightClick = this.onItemNew;\r\n\t\tthis.midIDList.renderItem = this.renderItem;\r\n\t\tthis.midIDList.onItemClick = this.onItemClick;\r\n\t\tthis.midIDList.renderRight = this.renderListRight;\r\n\t\tthis.midIDList.renderTop = this.renderListTop;\r\n\t\tthis.midIDList.renderBottom = this.renderListBottom;\r\n\t\tthis.cList = this.createCList();\r\n        return true;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.cList.call();\r\n\t\tthis.returnCall(this.valueChanged);\r\n\t}\r\n\r\n\tprotected createFormView() {\r\n\t\tlet {ID, IDUI} = this.midID;\r\n\t\tlet {fieldCustoms} = IDUI;\r\n\t\tlet formUI = new FormUI(ID.ui, fieldCustoms, ID.t);\r\n\t\tthis.cFormView = new CFormView(formUI);\r\n\t\tthis.cFormView.onSubmit = this.onSubmit;\r\n\t}\r\n\r\n\tprotected createCList() {\r\n\t\treturn new CList(this.midIDList);\r\n\t}\r\n\r\n\tprotected renderListRight: () => JSX.Element;\r\n\tprotected renderListTop: () => JSX.Element;\r\n\tprotected renderListBottom: () => JSX.Element;\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tawait this.saveID(context.data);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\trenderItem: (item:T, index:number) => JSX.Element = (item:T, index:number) => {\r\n\t\tlet {ID } = this.midID;\r\n\t\tif (ID) return ID.render(item);\r\n\t\treturn renderItem(item, index);\r\n\t}\r\n\tonItemClick: (item: T) => void = (item:any) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = item;\r\n\t\t\tthis.onItemView();\r\n\t\t});\r\n\t}\r\n\r\n\tonItemEdit = async (): Promise<void> => {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync onItemView():Promise<void> {\r\n\t\tthis.openVPage(VContent);\r\n\t}\r\n\r\n\tonItemNew = async (): Promise<void> => {\r\n\t\tawait this.cFormView.setNO(this.midID.ID);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = undefined;\r\n\t\t\tthis.openVPage(VEdit);\r\n\t\t});\r\n\t}\r\n\r\n\tasync saveID(itemProps:any) {\r\n\t\tlet id = this.item?.id;\r\n\t\tlet item = {\r\n\t\t\t...itemProps,\r\n\t\t\tid,\r\n\t\t}\r\n\t\tlet ret = await this.midID.saveID(item);\r\n\t\tif (ret) id = ret;\r\n\t\tthis.midIDList?.update(id, item);\r\n\t\trunInAction(() => {\r\n\t\t\tif (this.item)\r\n\t\t\t\tObject.assign(this.item, item);\r\n\t\t\telse\r\n\t\t\t\tthis.item = item;\r\n\t\t});\r\n\t\tthis.valueChanged = true;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tget itemHeader() {\r\n\t\treturn (this.midID.itemHeader as string ?? this.midID.ID.ui.label as string)\r\n\t}\r\n\r\n\tget editHeader() {\r\n\t\treturn this.t(this.item? 'edit' : 'new') + ' ' + this.itemHeader;\r\n\t}\r\n\r\n\trenderViewRight(item?: T) {\r\n\t\tif (item) this.item = item;\r\n\t\treturn this.renderView(VViewRight);\r\n\t}\r\n}\r\n","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\t\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\t//await this.ID.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(id:number, item:any) {\r\n\t\titem.id = id;\r\n\t\tthis.listPageItems.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXIDList<T extends IDBase> extends MidIDList<T> {\r\n\treadonly IX:IX;\r\n\tprivate ix?:number|(number[]);\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, ix:number|(number[])) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ix = ix;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ix,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\t/*\r\n\t\tfor (let item of ret) {\r\n\t\t\titem.id = item.id;\r\n\t\t\tdelete item.id;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, UiButton, UiItemCollection, IDUI, IX, ParamActIX } from \"tonva-react\";\r\nimport { IDBase, Mid } from \"../base\";\r\nimport { MidIDList, MidIXIDList } from \"./MidIDList\";\r\n\r\nexport class MidID<T extends IDBase> extends Mid {\r\n\treadonly IDUI: IDUI;\r\n\treadonly ID: ID;\r\n\r\n\tconstructor(uq: Uq, IDUI: IDUI) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDUI = IDUI;\r\n\t\tthis.ID = IDUI.ID;\r\n\t}\r\n\r\n\tlistHeader: string|JSX.Element;\r\n\titemHeader: string|JSX.Element;\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t\tthis._itemSchema = await this.buildItemSchema(this.IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(this.IDUI);\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIDList<T>(this.uq, this.ID);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet items:UiItemCollection = {};\r\n\t\tthis._uiSchema = {items};\r\n\t\tlet {fields} = ID.ui;\r\n\t\tif (fields) {\r\n\t\t\tfor (let f of this._itemSchema) {\r\n\t\t\t\tlet {name} = f;\r\n\t\t\t\tObject.assign(f, (fields as any)[name]);\r\n\t\t\t\t(items as any)[name] = f;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\treturn this._uiSchema;\r\n\t}\r\n\tprotected async loadSchema() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\r\n\tasync load(id:number): Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\tif (!id) return;\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema {\r\n\t\t//if (this._itemSchema !== undefined) \r\n\t\treturn this._itemSchema;\r\n\t\t//return this._itemSchema = this.buildItemSchema(this.ID);\r\n\t}\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema {\r\n\t\t//if (this._uiSchema !== undefined) \r\n\t\treturn this._uiSchema;\r\n\t\t//return this._uiSchema = this.buildUISchema(this.ID);\r\n\t}\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] {\r\n\t\tif (this._props !== undefined) return this._props;\r\n\t\treturn this._props = this.buildGridProps(this.IDUI.ID);\r\n\t}\r\n}\r\n\r\nexport class MidIXID<T extends IDBase> extends MidID<T> {\r\n\tprivate readonly IX: IX;\r\n\tprivate readonly ix:number;\r\n\tprivate readonly IXs?:{IX:IX, ix:number}[];\r\n\tconstructor(uq: Uq, IDUI: IDUI, IX: IX, ix:number, IXs?:{IX:IX, ix:number}[]) {\r\n\t\tsuper(uq, IDUI);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ix = ix;\r\n\t\tthis.IXs = IXs;\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIXIDList<any>(this.uq, this.ID, this.IX, this.ix);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: ParamActIX<T> = {\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tIXs: this.IXs,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ix:this.ix, xi:data}\r\n\t\t\t],\r\n\t\t};\r\n\t\tlet ret = await this.uq.ActIX(param);\r\n\t\tlet id = ret[0];\r\n\t\tif (!id) return;\r\n\t\treturn id;\r\n\t}\r\n}\r\n","export * from './base';\r\nexport * from './ID';\r\nexport * from './IDX';\r\nexport * from './IX';\r\nexport * from './sheet';\r\nexport * from './tag';\r\nexport * from './form';\r\nexport * from './roles';\r\nexport * from './select';\r\nexport * from './tools';\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\nimport { AppConfig, UqConfig } from '../app';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\r\n\tstatic async build(appConfig: AppConfig) {\r\n\t\tlet {app, uqs, tvs, version} = appConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (app) {\r\n\t\t\tlet {name, version} = app;\r\n\t\t\tretErrors = await UQsMan.load(name, version, tvs);\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await UQsMan.loadUqs(uqs, version, tvs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async load(tonvaAppName:string, version:string, tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsManApp(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n\t\tuqsMan.id = id;\r\n\t\t//console.error(uqAppData);\r\n\t\t//let ownerProfixMap: {[owner: string]: string};\r\n\t\treturn uqsMan.buildUqs(uqs, version);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async loadUqs(uqConfigs: UqConfig[], version:string, tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tvs);\r\n\t\tlet uqs = await loadUqs(uqConfigs);\r\n\t\treturn uqsMan.buildUqs(uqs, version, uqConfigs);\r\n\t}\r\n\r\n\tprivate uqMans: UqMan[] = [];\r\n    private collection: {[uqLower: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    protected constructor(tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n\t\tthis.buildTVs();\r\n\t\tthis.uqMans = [];\r\n        this.collection = {};\r\n    }\r\n\r\n\tprivate async buildUqs(uqDataArr:UqData[], version:string, uqConfigs?:UqConfig[]):Promise<string[]> {\r\n        await this.init(uqDataArr);\r\n\r\n\t\tlet localMap = env.localDb.map('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n        let retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tretErrors.push(...this.setTuidImportsLocal());\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet {dev, name, alias} = uqConfig;\r\n\t\t\t\tlet {name:owner, alias:ownerAlias} = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias??owner).toLowerCase() + '/' + (alias??name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tUQsMan._uqs = this.buildUQs();\r\n\t}\r\n\r\n\tstatic uq(uqName: string): UqMan {\r\n\t\treturn UQsMan.value.collection[uqName.toLowerCase()];\r\n\t}\r\n\t\r\n\tstatic async getUqUserRoles(uqLower:string):Promise<string[]> {\r\n\t\tlet uqMan = UQsMan.value.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n    private buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, ownerAlias, uqName, uqAlias} = uqData;\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n        //for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n            //let uq = this.collection[i];\r\n            promises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        //let that = this;\r\n        let uqs:any = {};\r\n        for (let uqMan of this.uqMans) {\r\n            let uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n        }\r\n        return new Proxy(uqs, {\r\n            get: (target, key, receiver) => {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                this.showReload(`新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let uqMan of this.uqMans) {\r\n            for (let tuid of uqMan.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n\tconstructor(tonvaAppName:string, tvs:TVs) {\r\n\t\tsuper(tvs);\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nasync function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret = await centerAppApi.appUqs(appOwner, appName);\r\n    return ret;\r\n}\r\n\r\nasync function loadUqs(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\tlet uqs: {owner:string; ownerAlias: string; name:string; alias:string; version:string}[] = uqConfigs.map(\r\n\t\tv => {\r\n\t\t\tlet {dev, name, version, alias} =v;\r\n\t\t\tlet {name:owner, alias:ownerAlias} = dev;\r\n\t\t\treturn {owner, ownerAlias, name, version, alias};\r\n\t\t}\r\n\t);\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret:UqData[] = await centerAppApi.uqs(uqs);\r\n\tfor (let i=0; i<uqs.length; i++) {\r\n\t\tlet {ownerAlias, alias} = uqs[i];\r\n\t\tret[i].ownerAlias = ownerAlias;\r\n\t\tret[i].uqAlias = alias;\r\n\t}\r\n    return ret;\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { runInAction } from \"mobx\";\r\nimport { ID, IX, Uq } from \"tonva-react\";\r\nimport { CList, MidIDListBase } from \"../list\";\r\nimport { IXBase } from \"../base\";\r\n\r\nexport class CIXList<T extends IXBase> extends CList<T> {\r\n\tprotected midIXList: MidIXList<T>;\r\n\tconstructor(midIXList: MidIXList<T>) {\r\n\t\tsuper(midIXList);\r\n\t\tthis.setRes(midIXList.res);\r\n\t\tthis.midIXList = midIXList;\r\n\t}\r\n\r\n\tupdate(item:any) {\r\n\t\tthis.midIXList.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXList<T extends IXBase> extends MidIDListBase<T> {\r\n\treadonly IX:IX;\r\n\treadonly ID:ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\t//key:((item:T) => number|string) = item => item.id 2;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: this.ID? [this.ID] : undefined,\r\n\t\t\tix: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(item:T) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet {_items} = this.listPageItems;\r\n\t\t\tif (!_items) return;\r\n\t\t\tlet {ix, xi} = item;\r\n\t\t\tif (xi < 0) {\r\n\t\t\t\tlet index = _items.findIndex(v => v.xi === -xi && v.xi === xi);\r\n\t\t\t\tif (index >= 0) _items.splice(index, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ret = _items.find(v => v.xi === xi && v.xi === xi);\r\n\t\t\t\tif (!ret) {\r\n\t\t\t\t\t_items.unshift({ix, xi} as T);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { Controller, ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../base\";\r\nimport { CIXList, MidIXList } from \"./CIXList\";\r\n\r\nexport class MidIX extends Mid {\r\n\treadonly IX: IX;\r\n\treadonly ID: ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n}\r\n\r\nexport class CIX<P extends MidIX> extends Controller {\r\n\tprotected readonly midIX: P;\r\n\r\n\tconstructor(midIX: P) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midIX.res);\r\n\t\tthis.midIX = midIX;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onItemEdit;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = this.onItemClick;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tlet idList = new CIXList(midIXList);\r\n\t\tawait idList.start();\r\n\t}\r\n\r\n\tprivate onItemEdit = () => {\r\n\r\n\t}\r\n\r\n\tprivate onItemClick = (item:any) => {\r\n\t\t\r\n\t}\r\n}\r\n","import { ID } from \"tonva-react\";\r\nimport { CIX, MidIX } from \"./CIX\";\r\nimport { CIXList, MidIXList} from \"./CIXList\";\r\nimport { CIXSelect, MidIXSelectList } from \"../select\";\r\n\r\nexport interface IXEditProps extends MidIX {\r\n\tID: ID;\r\n}\r\n\r\nexport class CIXEdit extends CIX<IXEditProps> {\r\n\tprivate cIXList: CIXList<any>;\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onListRightClick;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = undefined;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tthis.cIXList = new CIXList(midIXList);\r\n\t\tawait this.cIXList.start();\r\n\t}\r\n\r\n\tprivate onListRightClick = async () => {\r\n\t\tlet {uq, ID, IX, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXSelectList(uq, ID, IX, id);\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onSelectChange = this.onSelectChange;\r\n\t\tlet cSelect = new CIXSelect(midIXList);\r\n\t\tawait cSelect.start();\r\n\t}\r\n\r\n\tprivate onSelectChange = async (item:any, isSelected:boolean) => {\r\n\t\tlet param:any = {};\r\n\t\tlet {IX, id} = this.midIX;\r\n\t\tif (isSelected === false) {\r\n\t\t\t// id negtive means delete\r\n\t\t\tid = -id;\r\n\t\t}\r\n\t\tlet idItem = {ix:id, id: item.id};\r\n\t\tparam[IX.name] = [idItem];\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet ret = await this.midIX.uq.Acts(param);\r\n\t\tthis.cIXList.update(idItem);\r\n\t} \r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n\tresId: string = null;\r\n\t\r\n\tconstructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tsuper(edit, itemSchema, uiItem, label, value);\r\n\t\tmakeObservable(this, {\r\n\t\t\tresId: observable\r\n\t\t})\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed, makeObservable, runInAction} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    loading: boolean = false;\r\n    beforeLoad: boolean = true;\r\n    loaded: boolean = false;\r\n    _items:IObservableArray<T> = null;\r\n    allLoaded: boolean = false;\r\n    get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n    topDiv:string = '$$top';\r\n\tbottomDiv:string = '$$bottom';\r\n\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: observable,\r\n\t\t\tbeforeLoad: observable,\r\n\t\t\tloaded: observable,\r\n\t\t\t_items: observable,\r\n\t\t\tallLoaded: observable,\r\n\t\t\titems: computed,\r\n\t\t\ttopDiv: observable,\r\n\t\t\tbottomDiv: observable,\r\n\t\t});\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n\t\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.isFirst = true;\r\n\t\t\tthis.beforeLoad = true;\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.param = undefined;\r\n\t\t\tthis.allLoaded = false;\r\n\t\t\tthis.pageStart = undefined;\r\n\t\t\tthis._items.clear();\r\n\t\t\t//this.setPageStart(undefined);\r\n\t\t});\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loading = true;\r\n\t\t\tthis.changing = true;\r\n\t\t});\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tlet allLoaded:boolean;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            allLoaded = true;\r\n\t\t}\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.onLoaded();\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loaded = true;\r\n\t\t\tthis.allLoaded = allLoaded;\r\n\t\t\tthis.isFirst = false;\r\n\t\t\tthis.changing = false;\r\n\t\t\tthis.loading = false;\r\n\t\t});\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/\\\\w+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root !== null) return this.root;\r\n\t\tlet cLoc = this._cLoc();\r\n\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\treturn this.root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\treturn Navigo.cleanUrl(window.location.href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n    }\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n\tfileName: string = null;\r\n\t\r\n\tconstructor(props: ResUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfileName: observable,\r\n\t\t});\r\n\t}\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n\tonSaved?: (imageId:string) => Promise<void>;\r\n\timageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n\tprivate imgBaseSize: number;\r\n\tprivate imageTypes: string[];\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfile: observable,\r\n\t\t\tdesImgWidth: observable,\r\n\t\t\tdesImgHeight: observable,\r\n\t\t\tdesImgSize: observable,\r\n\t\t\tsrcImgWidth: observable,\r\n\t\t\tsrcImgHeight: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tsrcImage: observable,\r\n\t\t\tdesImage: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t});\r\n\t\tthis.resId = props.id;\r\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(this.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n\t\t\t\tthis.imgBaseSize = largeSize; break;\r\n\t\t\tcase 'xl':\r\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\r\n\t\t\tcase 'raw':\r\n\t\t\t\tthis.imgBaseSize = -1; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n\t\t\t\tlet w:number, h:number;\r\n\t\t\t\tif (this.imgBaseSize < 0) {\r\n\t\t\t\t\tw = width;\r\n\t\t\t\t\th = height;\r\n\t\t\t\t}\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n\t\t\tarr.push({caption:'超大图', size:'xl'});\r\n\t\t\tarr.push({caption:'原图', size:'raw'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\r\n\tcontent: string = null;\r\n\tfile: File = null;\r\n\tfileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n\tuploaded: boolean = false;\r\n\tuploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcontent: observable,\r\n\t\t\tfile: observable,\r\n\t\t\tfileSize: observable,\r\n\t\t\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t\tuploading: observable,\r\n\t\t});\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { CenterApi, centerApi, UqConfig } from '../app';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { nav } from '../components';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart:number;\r\n\tend?: number;\r\n\tsize:number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?:{IX:IX, ix:number}[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: {ix:number, xi:number|T}[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M,D> {\r\n\tmaster: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmaster: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M,D,D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M,D,D2,D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIDX?: (ID|IDX)[];\r\n\tIX?: IX[];\r\n\tid?: number | number[];\r\n\tkey?: {[key:string]:string|number};\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: {[key:string]:string|number};\r\n\tpage?: ParamPage;\r\n\torder?: 'desc'|'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmaster: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID|IDX) | (ID|IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID|IDX)[];\r\n\tIX?: IX[];\r\n\tkey: {[key:string]:string|number};\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: {[key:string]:string|number};\r\n\tIX: IX;\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID|IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number|number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number|Date;\r\n\tsetAdd: '='|'+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string|number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path:string):string {return path;}\r\n\r\nexport interface Uq {\r\n\t$: UqMan;\r\n\tActs(param:any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActDetail<M,D>(param: ParamActDetail<M,D>): Promise<RetActDetail>;\r\n\tActDetail<M,D,D2>(param: ParamActDetail2<M,D,D2>): Promise<RetActDetail2>;\r\n\tActDetail<M,D,D2,D3>(param: ParamActDetail3<M,D,D2,D3>): Promise<RetActDetail3>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M,D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M,D,D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M,D,D2,D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\tIXr<T> (param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDLog<T> (param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T> (param: ParamIDSum): Promise<T[]>;\r\n\tIDxID<T,T2> (param: ParamIDxID): Promise<[T[],T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param:ParamIDinIX): Promise<T&{$in:boolean}[]>;\r\n\tIDTree<T>(param:ParamIDTree): Promise<T[]>;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly entities: {[name:string]: Entity} = {};\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n\tprivate readonly actions: {[name:string]: Action} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n\tprivate readonly ids: {[name:string]: ID} = {};\r\n\tprivate readonly idxs: {[name:string]: IDX} = {};\r\n\tprivate readonly ixs: {[name:string]: IX} = {};\r\n\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localEntities: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n\tproxy: any;\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\r\n    uqVersion: number;\r\n\t//ownerProfix: string;\r\n\tconfig: UqConfig;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, /*access, */newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n\t\t//this.localMap = uqs.localMap.map(this.name);\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localEntities = this.localMap.child('$access');\r\n        let baseUrl = 'tv/';\r\n\r\n\t\t/*\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n\t\t}\r\n\t\t*/\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(env.unit);\r\n        }\r\n        else {\r\n            //let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, /*appOwner, appName, */uqOwner, uqName/*, acc*/, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n\tget center():CenterApi {return centerApi;}\r\n\r\n\tgetID(name:string):ID {return this.ids[name.toLowerCase()];};\r\n\tgetIDX(name:string):IDX {return this.idxs[name.toLowerCase()];};\r\n\tgetIX(name:string):IX {return this.ixs[name.toLowerCase()];};\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t\r\n\tprivate roles:string[];\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n\tallRoles: string[];\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly idArr: ID[] = [];\r\n    readonly idxArr: IDX[] = [];\r\n    readonly ixArr: IX[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let entities = this.localEntities.get();\r\n            if (!entities) {\r\n                entities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n            if (!entities) return;\r\n            this.buildEntities(entities);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localEntities.set(entities);\r\n        let {access, tuids, role, version} = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n        this.buildTuids(tuids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n\tprivate setEntity(name:string, entity:Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n\t\tthis.setEntity(name, tag);\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    private newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private newID(name:string, id:number):ID {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idEntity = this.ids[lName];\r\n        if (idEntity !== undefined) return idEntity;\r\n        idEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n        this.idArr.push(idEntity);\r\n        return idEntity;\r\n    }\r\n    private newIDX(name:string, id:number):IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idx = this.idxs[lName];\r\n        if (idx !== undefined) return idx;\r\n        idx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n        this.idxArr.push(idx);\r\n        return idx;\r\n    }\r\n    private newIX(name:string, id:number):IX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let ix = this.ixs[lName];\r\n        if (ix !== undefined) return ix;\r\n        ix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n        this.ixArr.push(ix);\r\n        return ix;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey:string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tif (this.config) {\r\n\t\t\tlet {dev, alias} = this.config;\r\n\t\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias??uqKey);\r\n\t\t}\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tcreateProxy():any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tdefault: debugger; break;\r\n\t\t\t\t\tcase 'Acts': return this.Acts;\r\n\t\t\t\t\tcase 'ActIX': return this.ActIX;\r\n\t\t\t\t\tcase 'ActIXSort': return this.ActIXSort;\r\n\t\t\t\t\tcase 'QueryID': return this.QueryID;\r\n\t\t\t\t\tcase 'IDDetail': return this.ActDetail;\r\n\t\t\t\t\tcase 'IDNO': return this.IDNO;\r\n\t\t\t\t\tcase 'IDDetailGet': return this.IDDetailGet;\r\n\t\t\t\t\tcase 'ID': return this.ID;\r\n\t\t\t\t\tcase 'KeyID': return this.KeyID;\r\n\t\t\t\t\tcase 'IX': return this.IX;\r\n\t\t\t\t\tcase 'IXr': return this.IXr;\r\n\t\t\t\t\tcase 'KeyIX': return this.KeyIX;\r\n\t\t\t\t\tcase 'IDLog': return this.IDLog;\r\n\t\t\t\t\tcase 'IDSum': return this.IDSum;\r\n\t\t\t\t\tcase 'IDinIX': return this.IDinIX;\r\n\t\t\t\t\tcase 'IDxID': return this.IDxID;\r\n\t\t\t\t\tcase 'IDTree': return this.IDTree;\r\n\t\t\t\t}\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\tthis.showReload('UQ错误：' + err);\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\treturn ret;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tthis.localMap.removeAll();\r\n\t\tnav.showReloadPage(msg);\r\n    }\r\n\r\n\t//private coms:any;\r\n\t//private setComs = (coms: any) => {this.coms = coms;}\r\n\tprivate Acts = async (param:any): Promise<any> => {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr:string[] = [];\r\n\t\tlet apiParam:any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj:any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv:any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.uqApi.post(IDPath('acts'), apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet retActs:{[key:string]:number[]} = {};\r\n\t\tfor (let i=0; i<arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprivate ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\tlet {IX, ID, values, IXs} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map(v => ({IX:entityName(v.IX), ix:v.ix})),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-ix'), apiParam);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprivate ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\tlet {IX, ix, id, after} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\tawait this.uqApi.post(IDPath('act-ix-sort'), apiParam);\r\n\t}\r\n\r\n\tprivate ActDetail = async (param: ParamActDetail<any, any>): Promise<any> => {\r\n\t\tlet {master, detail, detail2, detail3} = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam:any = {\r\n\t\t\tmaster: {\r\n\t\t\t\tname: entityName(master.ID),\r\n\t\t\t\tvalue: toScalars(master.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-detail'), postParam);\r\n\t\tlet val:string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmaster: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate QueryID = async (param: ParamQueryID): Promise<any[]> => {\r\n\t\tlet {ID, IX, IDX} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('query-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-no'), {ID: entityName(ID)});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\tlet {id, master, detail, detail2, detail3} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-detail-get'), {\r\n\t\t\tid,\r\n\t\t\tmaster: entityName(master),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\t//private checkParam(ID:ID, IDX:(ID|IDX)|(ID|IDX)[], IX:IX, id:number|number[], key:{[key:string]:string|number}, page: ParamPage) {\r\n\t//}\r\n\tprivate IDXToString(p:ID|IDX|((ID|IDX)[])):string|string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID|IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID|IDX);\r\n\t}\r\n\tprivate ID = async (param: ParamID): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\tlet {ID, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ix'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ixr'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\tlet {ID, IX, IDX} = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-log'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-sum'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDinIX = async (param:ParamIDinIX): Promise<any|{$in:boolean}[]> => {\r\n\t\tlet {ID, IX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-in-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDxID = async (param:ParamIDxID): Promise<any[]> => {\r\n\t\tlet {ID, IX, ID2} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-x-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDTree = async (param:ParamIDTree): Promise<any[]> => {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-tree'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nfunction ids(item:string[]):number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret:number[] = [];\r\n\tfor (let i=0; i<len-1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity:Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value:any):any {\r\n\tif (!value) return value;\r\n\tlet ret:any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { UqExt as Uq } from './JkMe';\r\nimport * as $Piecewise from './$Piecewise.ui';\r\nimport * as $PiecewiseDetail from './$PiecewiseDetail.ui';\r\nimport * as AccountType from './AccountType.ui';\r\nimport * as Account from './Account.ui';\r\nimport * as AccountCTO from './AccountCTO.ui';\r\nimport * as UserAccountType from './UserAccountType.ui';\r\n\r\nexport function setUI(uq: Uq) {\r\n\tObject.assign(uq.$Piecewise, $Piecewise);\r\n\tObject.assign(uq.$PiecewiseDetail, $PiecewiseDetail);\r\n\tObject.assign(uq.AccountType, AccountType);\r\n\tObject.assign(uq.Account, Account);\r\n\tObject.assign(uq.AccountCTO, AccountCTO);\r\n\tObject.assign(uq.UserAccountType, UserAccountType);\r\n}\r\nexport * from './JkMe';\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","//import * as React from 'react';\r\nimport { Page, nav, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n\tprivate params: {predefinedUnit:number, uqsLoadErrors:string[]};\r\n    async open(params: {predefinedUnit:number, uqsLoadErrors:string[]}) {\r\n\t\tthis.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet {predefinedUnit, uqsLoadErrors} = this.params;\r\n        let {user} = nav;\r\n\t\tlet userName:string = user? user.name : '[未登录]';\r\n\t\t//let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n\t\t\t\t{\r\n\t\t\t\t\tuqsLoadErrors && uqsLoadErrors.map(v => {\r\n\t\t\t\t\t\treturn <div className=\"form-group row\">\r\n\t\t\t\t\t\t\t<div className=\"col-sm-3 font-weight-bold\">App</div>\r\n\t\t\t\t\t\t\t<div className=\"col-sm text-body\">{v}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t</Page>;\t\t\r\n\t}\r\n\t/*\r\n\t<div className=\"form-group row\">\r\n\t\t<div className=\"col-sm-3 font-weight-bold\">\r\n\t\t\t可能原因<FA name=\"exclamation-triangle\" />\r\n\t\t</div>\r\n\t\t<div className=\"col-sm text-body\">\r\n\t\t\t<ul className=\"p-0\">\r\n\t\t\t\t<li>没有小号运行 {appName}</li>\r\n\t\t\t\t<li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n\t\t\t\t{\r\n\t\t\t\t\tpredefinedUnit && \r\n\t\t\t\t\t<li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n\t\t\t\t}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n\t*/\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\t//appInFrame.unit = appUnit.id; // 25;\r\n\t\t//this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n\t\t\t<div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n\t}\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { t, setGlobalRes } from '../res';\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { User } from \"../tool\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\t//devs?: DevConfig[];\r\n\tuqs?: UqConfig[];\r\n}\r\n\r\nexport interface AppConfig extends UqsConfig {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n    //appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs?: TVs;\r\n    //uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: U;\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper();\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {app, uqs} = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): U {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tsetRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) {}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet retErrors = await UQsMan.build(this.appConfig);\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n\t\t\tthis._uqs = UQsMan._uqs;\r\n\t\t\tthis.afterBuiltUQs(this._uqs);\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\t//let retErrors = UQsMan.errors;\r\n            //let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t\tnav.onChangeLogin = (user:User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\tlet {user} = nav;\r\n\t\tif (!user) return null;\r\n\t\tlet {roles:userRoles} = nav.user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles:string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await UQsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tnav.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tisAdmin(roles:string[]):boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles:string[], role:string):boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\r\n\tprotected onChangeLogin(user: User):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase<any>, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends Controller {\r\n    protected readonly _uqs: U;\r\n    protected readonly _cApp: A;\r\n\r\n    constructor(cApp: any) {\r\n        super();\r\n        this._cApp = cApp;\r\n        this._uqs = cApp?.uqs;\r\n\t}\r\n\r\n    get uqs(): U {return this._uqs}\r\n\tget cApp(): A {return this._cApp}\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\treturn this._cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase<A,U>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    newSub<O extends CBase<A,U>, T extends CSub<A,U,O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A,U> {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): T {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class UqTag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n\r\nexport class Tag extends UqTag {\r\n}","import { capitalCase } from \"../../tool\";\r\nimport { FieldItem, FieldUIType } from \"../../ui\";\r\n\r\nexport function buildFieldItem(field:any, isKey:boolean):FieldItem {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget:FieldUIType;\r\n\tlet {name, type} = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNum';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} as FieldItem;\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax, nav} from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un:string, pwd:string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n\tinit({onLogin, withBack}:{onLogin: (un:string, pwd:string) => Promise<boolean>; withBack: boolean;}) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type:string = sender !== undefined? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\r\n\theader() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{tonvaTop()}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema} \r\n\t\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{nav.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):Promise<void> {\r\n\t\tlet onLogin = async (un:string, pwd:string):Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\t\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, {onLogin, withBack});\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword():new (cLogin:CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword:string, newPassword:string):Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\t\treturn ret;\r\n\t\t});\r\n    }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\r\n    {type:'email', caption:'邮箱', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ml-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('mr-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../res';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true && always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from 'tonva-react/tool';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n\tprivate button: HTMLButtonElement;\r\n    private key: string = null;\r\n\t\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n\t\tconsole.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n\t\t}\r\n\t\telse {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n\t\t\tif (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n\t\tif (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n\t\tlet {className, inputClassName, onFocus,\r\n\t\t\tlabel, placeholder, buttonText, maxLength, size} = this.props;\r\n\t\tlet inputSize:string;\r\n\t\tswitch (size) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'sm': inputSize = 'input-group-sm'; break;\r\n\t\t\tcase 'md': inputSize = 'input-group-md'; break;\r\n\t\t\tcase 'lg': inputSize = 'input-group-lg'; break;\r\n\t\t}\r\n\t\tlet autoComplete:string;\r\n\t\tif (env.isMobile === true) autoComplete = 'off';\r\n\t\treturn <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n\t\t\t<div className={classNames(\"input-group\", inputSize)}>\r\n\t\t\t\t{label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n\t\t\t\t<input ref={v=>this.input=v} onChange={this.onChange}\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tname=\"key\"\r\n\t\t\t\t\tonFocus={onFocus}\r\n\t\t\t\t\tclassName={classNames('form-control', inputClassName || 'border-primary')}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tdefaultValue={this.props.initKey}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t<div className=\"input-group-append\">\r\n\t\t\t\t\t<button ref={v=>this.button=v} className=\"btn btn-primary\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\tdisabled={this.props.allowEmptySearch !== true}>\r\n\t\t\t\t\t\t<i className='fa fa-search' />\r\n\t\t\t\t\t\t<i className=\"fa\"/>\r\n\t\t\t\t\t\t{buttonText}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</form>;\t\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (nav.openSysPage(href) === false) {\r\n\t\t\t\t\tnav.navigate(href);\r\n\t\t\t   };\r\n\t\t\t   return false;\r\n\t\t   }\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> \r\n{\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","export * from './ui';\r\nexport * from './fieldItem';\r\nexport * from './fieldUI';\r\nexport * from './IDUI';\r\n","import { ButtonSchema, FieldItem, FieldItemId, FieldItemString, IDUI, IDXEntity, PickId, Prop, Schema, UiButton, UiSchema, Uq } from \"tonva-react\";\r\n\r\nexport abstract class Mid {\r\n\treadonly uq: Uq;\r\n\treadonly res: any;\r\n\tconstructor(uq: Uq, res?: any) {\r\n\t\tthis.uq = uq;\r\n\t\tthis.res = res;\r\n\t}\r\n\r\n\tabstract init():Promise<void>;\r\n\r\n\tprotected async buildItemSchema(IDUI: IDUI): Promise<Schema> {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet ret:Schema = [];\r\n\t\tlet {fieldArr} = ID.ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t\tlet {ID} = fieldItem;\r\n\t\t\tif (ID) {\r\n\t\t\t\tlet importSelect = await import('../select');\r\n\t\t\t\tthis.setIDUi(fieldItem, importSelect.createPickId(this.uq, ID), ID.render);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet {fields} = ID.ui;\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildGridProps(IDX: IDXEntity<any>):Prop[] {\r\n\t\tlet ret:Prop[] = [];\r\n\t\tlet {ui, t, schema} = IDX;\r\n\t\tlet {exFields} = schema;\r\n\t\tlet {fieldArr } = ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet exField = (exFields as any[]).find(v => v.field === f.name);\r\n\t\t\tif (!exField) continue;\r\n\t\t\tlet prop = {\r\n\t\t\t\t...f,\r\n\t\t\t\tlabel: t(f.label),\r\n\t\t\t};\r\n\t\t\tret.push(prop as any);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected setIDUi(fieldItem:FieldItem, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tif (fieldItem.type !== 'id') {\r\n\t\t\talert(`${fieldItem.name} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = fieldItem as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tprotected setNO(no:string, noFieldItem: FieldItem) {\r\n\t\tif (!noFieldItem) return;\r\n\t\tif (noFieldItem.type !== 'string') return;\r\n\t\tlet noField = noFieldItem as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n}\r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly:boolean;\r\n\t\r\n\tdisabled:boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    visible:boolean = null;\r\n\tvalue: any = null;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\tcontextErrors: observable,\r\n\t\t\thasError: computed,\r\n\t\t\tvisible: observable,\r\n\t\t\tvalue: observable,\r\n\t\t\tdisabled: observable,\r\n\t\t});\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n\t\tthis.disabled = value;\r\n\t}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\t\r\n\t\t});\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n\t\t\t\tnew RuleInt(res, min, max) :\r\n\t\t\t\tnew RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n\t\tswitch (typeof value) {\r\n\t\t\tdefault: return;\r\n\t\t\tcase 'undefined': return;\r\n\t\t\tcase 'number': return value;\r\n\t\t\tcase 'string':\r\n\t\t\t\tif ((value as string).trim().length === 0) return;\r\n\t\t\t\treturn Number(value);\r\n\t\t}\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n\t\tlet id = await pickId(this.context, this.name, this.value);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.setDataValue(id);\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t\tthis.checkRules();\t\r\n\t\t});\r\n    }\r\n\r\n\tsetValue(value:any) {\r\n\t\tsuper.setValue(value);\r\n\t}\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\ninterface WidgetFactory {\r\n\twidget?: TypeWidget;\r\n\tdataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n\tdataTypes: ['integer', 'number', 'string'],\r\n\twidget: TextWidget\r\n};\r\n\r\nconst widgetFactories: {[type: string]: WidgetFactory} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: stringWidget,\r\n\tstring: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\t\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType, hiden} = ui;\r\n\t\tif (hiden === true) return null;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetFactories[widgetType];\r\n\t\t\t\tif (!widgetFactory) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`unknown widget ${widgetType}`);\r\n\t\t\t\t}\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes, resLang } from '../../res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n\tfieldLabelAlign?: 'left'|'center'|'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n\t\t} = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize, fieldLabelAlign} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n\t\t\t\tlet cnAlign: string;\r\n\t\t\t\tswitch (fieldLabelAlign) {\r\n\t\t\t\t\tcase 'right': cnAlign = 'text-sm-right'; break;\r\n\t\t\t\t\tcase 'center': cnAlign = 'text-sm-center'; break;\r\n\t\t\t\t}\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n\ttype: string;\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tstep?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprotected inputOptions():InputOptions {\r\n\t\treturn {\r\n\t\t\ttype: 'text',\r\n\t\t}\r\n\t}\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tlet {type, max, min, step} = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type={type}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { ID, IDX, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDXList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\treadonly IDX: IDX;\r\n\tconstructor(uq:Uq, ID:ID, IDX:IDX) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IDX = IDX;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t]);\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tday: '日',\r\n\tweek: '周',\r\n\tmonth: '月',\r\n\tyear: '年',\r\n}","export const en = {\r\n\tday: 'Day',\r\n\tweek: 'Week',\r\n\tmonth: 'Month',\r\n\tyear: 'Year',\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, left0, LMR, NumberProp, StringProp, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VEdit extends VPage<CIDX> {\r\n\theader() {return 'Edit'}\r\n\tcontent() {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t{props.map((v, index) => {\r\n\t\t\t\tlet {type} = v as any;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tdefault: return null;\r\n\t\t\t\t\tcase 'string': \r\n\t\t\t\t\t\treturn this.renderStringProp(v as StringProp);\r\n\t\t\t\t\tcase 'integer':\r\n\t\t\t\t\tcase 'number': \r\n\t\t\t\t\t\treturn this.renderNumberProp(v as NumberProp);\r\n\t\t\t\t}\r\n\t\t\t})}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderStringProp(prop:StringProp) {\r\n\t\treturn <div key={prop.name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\">\r\n\t\t\t{JSON.stringify(prop)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderNumberProp(prop: NumberProp) {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {name} = prop;\r\n\t\t\tlet {spanValues} = this.controller;\r\n\t\t\tif (!spanValues) return null;\r\n\t\t\treturn <div key={name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\" \r\n\t\t\t\tonClick={()=>this.openVPage(VEditNumberField, prop)}>\r\n\t\t\t\t<LMR left={<b>{prop.label}</b>} \r\n\t\t\t\t\tright={<FA name=\"pencil-square-o\" className=\"align-self-center\" />}>\r\n\t\t\t\t\t<div className=\"mr-5 text-right\">{this.controller.spanValues[name]}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nclass VEditNumberField extends VPage<CIDX> {\r\n\tprivate prop: NumberProp;\r\n\tprivate date: Date;\r\n\tprivate value: number;\r\n\tprivate dateInput: HTMLInputElement;\r\n\tprivate timeInput: HTMLInputElement;\r\n\tdisabled: boolean = true;\r\n\tconstructor(controller: CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdisabled: observable\r\n\t\t});\r\n\t}\r\n\tinit(prop: NumberProp) {\r\n\t\tthis.prop = prop;\r\n\t\tthis.date = new Date();\r\n\t}\r\n\theader() {return this.prop.label}\r\n\tright() {\r\n\t\tlet V = observer(() => <button \r\n\t\t\tclassName=\"btn btn-sm btn-success mr-2\" \r\n\t\t\tdisabled={this.disabled}\r\n\t\t\tonClick={this.onSave}>\r\n\t\t\t{this.t('submit')}\r\n\t\t</button>);\r\n\t\treturn <V />;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {time} = this.prop;\r\n\t\tlet year = this.date.getFullYear();\r\n\t\tlet month = this.date.getMonth() + 1;\r\n\t\tlet day = this.date.getDate();\r\n\t\tlet hour = this.date.getHours();\r\n\t\tlet minute = this.date.getMinutes();\r\n\t\tlet defDate = `${year}-${left0(month, 2)}-${left0(day, 2)}`;\r\n\t\tlet vDateTime:any;\r\n\t\tif (time === true) {\r\n\t\t\tvDateTime = <div className=\"input-group mb-3\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('date')}</span>\r\n\t\t\t\t<input ref={d => this.dateInput=d} type=\"date\" \r\n\t\t\t\t\tclassName=\"form-control\" defaultValue={defDate} />\r\n\t\t\t\t<input ref={t => this.timeInput=t} type=\"time\" className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={`${left0(hour, 2)}:${left0(minute, 2)}`} />\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{vDateTime}\r\n\t\t\t<div className=\"input-group\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('value')}</span>\r\n\t\t\t\t<input type=\"number\" className=\"form-control\" \r\n\t\t\t\t\tonChange={this.onValueChange} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onValueChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet v = evt.currentTarget.value.trim();\r\n\t\tthis.disabled = v.length === 0;\r\n\t\tlet n = Number(v);\r\n\t\tif (Number.isNaN(n) === false) this.value = n;\r\n\t}\r\n\r\n\tprivate onSave = async () => {\r\n\t\tlet t: number;\r\n\t\tif (this.dateInput) {\r\n\t\t\tlet date = this.dateInput.valueAsDate;\r\n\t\t\tlet dateTicks = this.dateInput?.valueAsNumber;\r\n\t\t\tlet timeTicks = this.timeInput?.valueAsNumber;\r\n\t\t\tt = dateTicks + timeTicks + date.getTimezoneOffset()*60*1000;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tt = Date.now();\r\n\t\t}\r\n\t\tawait this.controller.saveFieldValue(this.prop.name, t, this.value);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { VPage, List, LMR, EasyTime, UserView, User, View } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VHistory extends View<CIDX> {\r\n\trender() {\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.historyItems} item={{render: this.renderItem, key:(item)=>item.t}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\tlet {t, v, u} = item;\r\n\t\tlet left = <div className=\"w-12c\"><EasyTime date={new Date(t)} /></div>;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <small className=\"text-muted\">{nick || name}</small>\r\n\t\t}\r\n\t\tlet right = <UserView user={u} render={renderUser} />;\r\n\t\treturn <div className=\"px-3 py-2\">\t\t\t\r\n\t\t\t<LMR className=\"w-100\" left={left} right={right}>{v}</LMR>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nexport class VHistoryPage extends VPage<CIDX> {\r\n\theader() {return this.controller.field}\r\n\tcontent() {\r\n\t\treturn this.renderVm(VHistory);\r\n\t}\r\n\r\n}\r\n","import { makeObservable, observable, runInAction, toJS } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CSSProperties } from \"react\";\r\nimport { Bar } from \"react-chartjs-2\";\r\nimport { FA, LMR, NumberProp, Prop, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nconst spans = ['week', 'month'];\r\n\r\nconst graphOptions = {\r\n\ttitle: {\r\n\t\tdisplay: false,\r\n\t},\r\n\tmaintainAspectRatio: false,\r\n}\r\n\r\nexport class VView extends VPage<CIDX> {\r\n\tcurrentIndex: number = 0;\r\n\tconstructor(controller:CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcurrentIndex: observable,\r\n\t\t});\r\n\t}\r\n\r\n\theader() {return 'View'}\r\n\tright() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\t\t\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {spanValues, midIDX, timeSpan, prevTimeSpan, nextTimeSpan, dayValues} = this.controller;\r\n\t\t\tif (spanValues === null) return null; \r\n\t\t\tlet {props} = midIDX;\r\n\t\t\tconst data = {\r\n\t\t\t\tlabels: timeSpan.labels,\r\n\t\t\t\tdatasets: [{\r\n\t\t\t\t\tlabel: '',\r\n\t\t\t\t\tdata: toJS(dayValues),\r\n\t\t\t\t\tbackgroundColor: 'lightgreen',\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t}],\r\n\t\t\t};\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {label, name} = curProp;\r\n\t\t\tlet moveStep = (icon:string, spanStep: ()=>Promise<void>) => <div \r\n\t\t\t\tclassName={'p-3 ' + (spanStep? 'cursor-pointer' : 'text-muted')} \r\n\t\t\t\tonClick={spanStep}>\r\n\t\t\t\t\t<FA name={icon} />\r\n\t\t\t\t</div>;\r\n\t\t\tlet left = moveStep('chevron-left', prevTimeSpan);\r\n\t\t\tlet right = timeSpan.canNext === true?\r\n\t\t\t\tmoveStep('chevron-right', nextTimeSpan)\r\n\t\t\t\t:\r\n\t\t\t\tmoveStep('square-o', undefined);\r\n\t\t\t\t//<div><FA className=\"text-muted\" name=\"square-o\" /></div>;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t\t{spans.map(v => {\r\n\t\t\t\t\t\t\tlet cn = 'col text-center p-2 cursor-pointer ';\r\n\t\t\t\t\t\t\tlet style:CSSProperties = {\r\n\t\t\t\t\t\t\t\tborderBottomWidth: '0.15rem',\r\n\t\t\t\t\t\t\t\tborderBottomStyle: 'solid',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (timeSpan.type === v) {\r\n\t\t\t\t\t\t\t\tcn += 'text-primary font-weight-bold';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'blue';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn += 'text-muted';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'lightgray';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} style={style} \r\n\t\t\t\t\t\t\t\tonClick={()=>this.tabClick(v as any)}>{this.t(v)}</div>;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<LMR className=\"text-center align-items-center\" left={left} right={right} >\r\n\t\t\t\t\t{timeSpan.title}\r\n\t\t\t\t</LMR>\r\n\t\t\t\t<div className=\"mt-3 mx-3 text-center cursor-pointer\"\r\n\t\t\t\t\tonClick={() => this.onFieldHistory(name)}>\r\n\t\t\t\t\t<h4 className=\"d-inline\">{label}</h4>\r\n\t\t\t\t\t<span className=\"text-info small\"> <FA name=\"angle-double-right\" /> 查看明细</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"p-3 h-12c\">\r\n\t\t\t\t\t<Bar data={data} width={100} height={50} options={graphOptions} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap p-1\"> \r\n\t\t\t\t\t{props.map((v, index) => {\r\n\t\t\t\t\t\tlet {name, label} = v as any;\r\n\t\t\t\t\t\tlet sv = spanValues[name];\r\n\t\t\t\t\t\tlet val = sv?\r\n\t\t\t\t\t\t\t<b className=\"h3 mb-0\">{sv}</b>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<small className=\"text-muted\">0</small>\r\n\t\t\t\t\t\tlet cn = 'm-1 w-8c h-8c d-flex flex-column align-items-center justify-content-center bg-white px-3 cursor-pointer border rounded ';\r\n\t\t\t\t\t\tcn += (index === this.currentIndex)? ' border-primary' : ' ';\r\n\t\t\t\t\t\treturn <div key={index} className={cn} onClick={() => this.onFieldClick(v, index)}>\r\n\t\t\t\t\t\t\t<div className=\"my-3 h-4c d-flex align-items-center\">{val}</div>\r\n\t\t\t\t\t\t\t<div className=\"mb-3\">{label}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n\r\n\tprivate tabClick(span:'day'|'week'|'month'|'year') {\r\n\t\tthis.controller.setTimeSpan(span);\r\n\t}\r\n\r\n\tprivate async onFieldClick(prop:Prop, index:number) {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\tif (this.currentIndex === index) {\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tawait this.controller.showFieldHistory(name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.currentIndex = index;\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tthis.controller.setCurrentField(name);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async onFieldHistory(field:string) {\r\n\t\tawait this.controller.showFieldHistory(field);\r\n\t}\r\n}\r\n","import { action, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Controller, PageItems } from \"tonva-react\";\r\nimport { HistoryPageItems, TimeSpan } from \"../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidIDX } from \"./MidIDX\";\r\nimport { MidIDXList } from \"./MidIDXList\";\r\nimport { res } from \"./res\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VHistory, VHistoryPage } from \"./VHistory\";\r\nimport { VView } from \"./VView\";\r\n\r\nexport class CIDX extends Controller {\r\n\ttimeSpan:TimeSpan = null;\r\n\tspanValues: any = null;\r\n\tdayValues: number[] = null;\r\n\tmidIDX: MidIDX;\r\n\tprivate cList: CList<any>;\r\n\tprivate historyPageItems: HistoryPageItems<any>\r\n\tconstructor(midIDX: MidIDX) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\ttimeSpan: observable,\r\n\t\t\tspanValues: observable,\r\n\t\t\tdayValues: observable.ref,\r\n\t\t\tsetTimeSpan: action,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midIDX.res);\r\n\t\tthis.midIDX = midIDX;\r\n\t\tthis.historyPageItems = new HistoryPageItems<any>(midIDX.historyLoader);\r\n\t}\r\n\r\n\tprotected async beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDX.init();\r\n\t\tlet {uq, ID, IDX} = this.midIDX;\r\n\t\tlet midIDXList = new MidIDXList(uq, ID, IDX);\r\n\t\tmidIDXList.onItemClick = this.onItemClick;\r\n\t\tthis.cList = new CList(midIDXList);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.cList.start();\r\n\t}\r\n\r\n\tasync showItemView(item: any) {\r\n\t\tawait this.midIDX.init();\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\titem:any;\r\n\tonItemClick: (item:any) => void = async (item:any) => {\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tonItemEdit = async ():Promise<void> => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync setTimeSpan(span: 'day'|'week'|'month'|'year') {\r\n\t\tlet timeSpan = TimeSpan.create(span);\r\n\t\tthis.timeSpan = timeSpan;\r\n\t\tawait this.loadSum(timeSpan);\r\n\t}\r\n\r\n\tprivate async loadSum(timeSpan?: TimeSpan) {\r\n\t\tlet {far, near} = timeSpan ?? this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadSum(this.item.id, far, near);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet [values, sums] = ret;\r\n\t\tlet sum = sums[0];\r\n\t\trunInAction(() => {\r\n\t\t\tthis.spanValues = sum ?? {};\r\n\t\t});\r\n\t\tawait this.loadDayValues();\r\n\t}\r\n\r\n\tprevTimeSpan = async () => {\r\n\t\tthis.timeSpan.prev();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tnextTimeSpan = async () => {\r\n\t\tthis.timeSpan.next();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tget historyItems():PageItems<any> {return this.historyPageItems;}\r\n\tfield:string;\r\n\r\n\tasync startFieldHistory(item: any, field:string) {\r\n\t\tthis.item = item;\r\n\t\tthis.field = field;\r\n\t\tawait this.midIDX.init();\r\n\t\t//await this.setTimeSpan('year');\r\n\t\tlet timeSpan = TimeSpan.create('year');\r\n\t\tthis.historyPageItems.first({\r\n\t\t\tid: this.item.id,\r\n\t\t\tfar: timeSpan.far,\r\n\t\t\tnear: 1817507137000, //this.timeSpan.near,\r\n\t\t\tfield\r\n\t\t});\r\n\t}\r\n\r\n\trenderFieldHistory() {\r\n\t\treturn this.renderView(VHistory);\r\n\t}\r\n\r\n\tasync showFieldHistory(field:string) {\r\n\t\tawait this.startFieldHistory(this.item, field);\r\n\t\tthis.openVPage(VHistoryPage);\r\n\t}\r\n\r\n\tasync loadDayValues() {\r\n\t\tlet {far, near} = this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadDayValues(this.item.id, this.field, far, near);\r\n\t\tlet dayValues = this.timeSpan.getDayValues(ret);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.dayValues = dayValues;\r\n\t\t});\r\n\t}\r\n\r\n\tsetCurrentField(field:string) {\r\n\t\tthis.field = field;\r\n\t\tthis.loadDayValues();\r\n\t}\r\n\r\n\tasync saveFieldValue(field:string, t:number, value:number|string) {\r\n\t\tlet {id} = this.item;\r\n\t\tawait this.midIDX.saveFieldValue(id, field, t, value);\r\n\t\tlet ret = await this.midIDX.loadFieldSum(id, field, this.timeSpan);\r\n\t\tlet v= ret[field];\r\n\t\tthis.spanValues[field] = v;\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, IDX } from \"tonva-react\";\r\nimport { TimeSpan } from \"../tools\";\r\nimport { Mid } from \"../base\";\r\n\r\nexport class MidIDX extends Mid {\r\n\treadonly IDX: IDX;\r\n\treadonly ID: ID;\r\n\treadonly timeZone: number;\r\n\tconstructor(uq: Uq, IDX: IDX, ID: ID, timeZone:number) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDX = IDX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.timeZone = timeZone;\r\n\t}\r\n\t\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadSchema() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t]);\r\n\t\tlet IDUI = {ID: this.ID};\r\n\t\tthis._itemSchema = await this.buildItemSchema(IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(IDUI);\r\n\t\tthis._props = this.buildGridProps(this.IDX);\r\n\t\tlet {exFields} = this.IDX.schema;\r\n\t\tfor (let prop of this._props) {\r\n\t\t\tlet {name} = prop as any;\r\n\t\t\tif (!name) continue;\r\n\t\t\tlet ex = (exFields as any[])?.find(v => v.field === name);\r\n\t\t\tlet time = ex?.time;\r\n\t\t\tif (!time) continue;\r\n\t\t\t(prop as any).time = time;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tasync load(id:number): Promise<any[]> {\r\n\t\tlet ret = await this.uq.ID({\r\n\t\t\tIDX: [this.ID, this.IDX],\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\thistoryLoader = async (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number):Promise<any[]> => {\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tid,\r\n\t\t\tlog: 'each',\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: pageStart,\r\n\t\t\t\tsize: pageSize,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tasync saveFieldValue(id:number, fieldName:string, t:any, value:string|number):Promise<void> {\r\n\t\tlet param: any = {};\r\n\t\tlet val: any = {id};\r\n\t\tval[fieldName] = {\r\n\t\t\t$time: t,\r\n\t\t\tvalue,\r\n\t\t}\r\n\t\tparam[this.IDX.name] = [val];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadFieldSum(id:number, field:string, timeSpan:TimeSpan):Promise<any> {\r\n\t\tlet {far, near} = timeSpan;\r\n\t\tlet retSum = await this.uq.IDSum({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield: [field],\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t});\r\n\t\tlet ret = retSum[0];\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadSum(id:number, far:number, near:number):Promise<[any[], any[]]> {\r\n\t\tlet valueFields:string[] = [];\r\n\t\tlet {fields, exFields} = this.IDX.schema;\r\n\t\tif (exFields === undefined) {\r\n\t\t\tthrow new Error('no valid sum field in exFields');\r\n\t\t}\r\n\t\tfor (let ex of exFields) {\r\n\t\t\tlet {field, log} =  ex;\r\n\t\t\tif (log !== true) continue;\r\n\t\t\tlet f = (fields as any[]).find(v => v.name === field);\r\n\t\t\tif (f === undefined) continue;\r\n\t\t\tlet {name, type} = f;\r\n\t\t\tif (['int', 'tinyint', 'smallint', 'bigint', 'dec', 'float', 'double'].indexOf(type) < 0) continue;\r\n\t\t\tvalueFields.push(name);\r\n\t\t}\r\n\t\treturn await Promise.all([\r\n\t\t\tthis.uq.ID({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tid,\r\n\t\t\t}),\r\n\t\t\tthis.uq.IDSum({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tfield: valueFields,\r\n\t\t\t\tid,\r\n\t\t\t\tfar,\r\n\t\t\t\tnear,\r\n\t\t\t}),\r\n\t\t]);\r\n\t}\r\n\r\n\tasync loadDayValues(id:number, field: string, far:number, near:number):Promise<any[]> {\r\n\t\tif (!field) {\r\n\t\t\tfield = (this._props[0] as any)?.name;\r\n\t\t\tif (!field) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\talert('no field in loadDayValues');\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tlog: 'day',\r\n\t\t\ttimeZone: this.timeZone,\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: near,\r\n\t\t\t\tend: far,\r\n\t\t\t\tsize: 100,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema { return this._itemSchema; }\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema { return this._uiSchema; }\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] { return this._props; }\r\n}\r\n","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../base\";\r\n\r\ninterface TagTree {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n\tsub: {[id:number]: TagTree};\r\n\tcount: number;\r\n}\r\n\r\ninterface TagItem {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n}\r\n\r\nexport interface Tag {\r\n\tid: number;\r\n\tname: string;\r\n\tparent: number;\r\n\tsub: Tag[];\r\n}\r\n\r\nexport class MidTag extends Mid {\r\n\treadonly ID: ID;\r\n\treadonly IX: IX;\r\n\treadonly tag: ID;\r\n\treadonly type: string;\r\n\t\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]: Tag};\r\n\r\n\tconstructor(uq: Uq, ID:ID, IX:IX, tag:ID, type: string) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IX = IX;\r\n\t\tthis.tag = tag;\r\n\t\tthis.type = type;\r\n\t}\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.load();\r\n\t}\r\n\r\n\tprotected async load(): Promise<void> {\r\n\t\tif (this.typeArr) return;\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IX.loadSchema(),\r\n\t\t\tthis.tag.loadSchema(),\r\n\t\t\tthis.uq.IDTree<TagItem>({\r\n\t\t\t\tID: this.tag,\r\n\t\t\t\tparent: 0,\r\n\t\t\t\tkey: this.type,\r\n\t\t\t\tlevel: 3,\r\n\t\t\t\tpage: {start:0, size:1000},\r\n\t\t\t})\r\n\t\t]);\r\n\t\tthis.buildTagTypes(ret[3]);\r\n\t}\r\n\r\n\tprivate buildTagTypes(items: TagItem[]) {\r\n\t\tlet root:TagTree;\r\n\t\tlet tree:TagTree = {id:0, parent:-1, name:undefined, sub:{}, count:0};\r\n\t\tfor (let item of items) {\r\n\t\t\tlet {id, parent, name} = item;\r\n\t\t\tif (parent === 0) {\r\n\t\t\t\ttree.sub[id] = root = {id, parent, name, sub: {}, count:0};\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet p = tree.sub[parent];\r\n\t\t\tlet tag:TagTree = {id, parent, name, sub: {}, count:0};\r\n\t\t\ttree.sub[id] = tag;\r\n\t\t\tif (p !== undefined) {\r\n\t\t\t\tp.sub[id] = tag;\r\n\t\t\t\tp.count++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i in tree.sub) {\r\n\t\t\tlet tag = tree.sub[i];\r\n\t\t\tlet {parent} = tag;\r\n\t\t\tif (parent > 0) {\r\n\t\t\t\tlet p = tree.sub[parent];\r\n\t\t\t\tif (p) p.sub[Number(i)] = tag;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.typeArr = [];\r\n\t\tthis.typeColl = {};\r\n\t\tif (!root) return;\r\n\t\tfor (let i in root.sub) {\r\n\t\t\tlet tree = root.sub[i];\r\n\t\t\tlet {id, name} = tree;\r\n\t\t\tlet type:Tag = {id, name, sub:[], parent: undefined};\r\n\t\t\tthis.typeArr.push(type);\r\n\t\t\tthis.typeColl[id] = type;\r\n\t\t\tfor (let j in tree.sub) {\r\n\t\t\t\tlet s = tree.sub[j];\r\n\t\t\t\tlet {id, name} = s;\r\n\t\t\t\ttype.sub.push({id, name, sub:undefined, parent:type.id})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSelect } from \"./CSelect\";\r\nimport { Tag } from '../MidTag';\r\nimport { ItemTags } from '../CIDTagList';\r\n\r\ninterface TagGroup {\r\n\tid: number;\r\n\tname:string;\r\n\tchecks: {tag: Tag, selected: boolean}[];\r\n}\r\n\r\nexport class VSelect extends VPage<CSelect> {\r\n\tprivate tagGroups:TagGroup[];\r\n\tinit() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {typeColl} = itemTags as ItemTags<any>;\r\n\t\tthis.tagGroups = [];\r\n\t\tfor (let midType of midTag.typeArr) {\r\n\t\t\tlet {id, name} = midType;\r\n\t\t\tlet type = typeColl[id];\r\n\t\t\tlet checks: {tag:Tag; selected: boolean}[] = [];\r\n\t\t\tlet tagGroup = {id, name, checks};\r\n\t\t\tfor (let s of midType.sub) {\r\n\t\t\t\tlet {id: tagId} = s;\r\n\t\t\t\tlet selected = \r\n\t\t\t\t\ttype === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t:\r\n\t\t\t\t\ttype.sub.findIndex(v => v.id === tagId) >= 0;\r\n\t\t\t\tchecks.push({tag:s, selected});\r\n\t\t\t}\r\n\t\t\tthis.tagGroups.push(tagGroup);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {return 'select'}\r\n\tcontent() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {item} = itemTags;\r\n\t\t//let {tags} = midTag;\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\t<div className=\"my-3\">{midTag.ID.render(item)}</div>\r\n\t\t\t{this.tagGroups.map(v => this.renderType(v))}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderType(group: TagGroup) {\r\n\t\tlet {id, name, checks}  = group;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{checks.map(v => {\r\n\t\t\t\tlet {tag, selected} = v;\r\n\t\t\t\tlet {id, name} = tag;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.controller.onTagSelectChanged(tag, evt.currentTarget.checked)}\r\n\t\t\t\t\t\tdefaultChecked={selected} />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}","import { Controller } from \"tonva-react\";\r\nimport { MidTag, Tag } from \"../MidTag\";\r\nimport { CIDTagList } from '../CIDTagList';\r\nimport { VSelect } from \"./VSelect\";\r\n\r\nexport class CSelect extends Controller {\r\n\tprivate cIDTagList: CIDTagList<any>;\r\n\titemTags: any;\r\n\tmidTag: MidTag;\r\n\tconstructor(cIDTagList: CIDTagList<any>, itemTags:any, midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.cIDTagList = cIDTagList;\r\n\t\tthis.itemTags = itemTags;\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VSelect);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tonTagSelectChanged = async (tag:Tag, selected:boolean) => {\r\n\t\tawait this.cIDTagList.onTagSelectChanged(this.itemTags, tag, selected);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { MidIDTagList, ItemTags } from \"./CIDTagList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport function renderRight(onClick: () => void) {\r\n\treturn <button className=\"btn btn-sm btn-primary mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>;\r\n}\r\n\r\nexport function renderItemTags<T extends IDBase>(midIDTagList: MidIDTagList<T>, itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {midTag, renderItem, renderTags} = midIDTagList;\r\n\t\t//let {renderItem} = midTag;\r\n\t\tlet {ID} = midTag;\r\n\t\tlet {item, typeArr} = itemTags;\r\n\t\treturn <div className=\"d-block\">\r\n\t\t\t<div>{(renderItem ??  ID.render)(item as any, index)}</div>\r\n\t\t\t<div className=\"text-muted mt-1\">{(renderTags ?? defaultRenderTags)(typeArr)}</div>\r\n\t\t</div>;\t\r\n\t});\r\n\treturn <V />;\r\n}\r\n\r\nfunction defaultRenderTags(typeArr:Tag[]):JSX.Element {\r\n\treturn <>\r\n\t\t{\r\n\t\t\ttypeArr.map(type => {\r\n\t\t\t\tlet {id, name} = type;\r\n\t\t\t\treturn <span key={id} className=\"mr-3\">\r\n\t\t\t\t\t<b>{name}</b>: {renderType(type)}\r\n\t\t\t\t</span>;\r\n\t\t\t})\r\n\t\t}\r\n\t</>;\r\n}\r\n\r\nfunction renderType(type:Tag):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {sub} = type;\r\n\t\treturn <>{sub.map(tag => {\r\n\t\t\tlet {id, name} = tag;\r\n\t\t\treturn <span className=\"mr-1\" key={id}>{name}</span>\r\n\t\t})}</>;\r\n\t});\r\n\treturn <V />;\r\n}","import { CList, MidList } from \"../list\";\r\nimport { IXBase, IDBase } from \"../base\";\r\nimport { ListPageItems } from \"../tools\";\r\nimport { CSelect } from \"./select\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { renderItemTags } from \"./parts\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport interface ItemTags<T> {\r\n\titem: T;\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]:Tag};\r\n}\r\n\r\nexport class CIDTagList<T extends IDBase> extends CList<ItemTags<T>> {\r\n\tprivate midIDTagList: MidIDTagList<T>;\r\n\tconstructor(midIDTagList: MidIDTagList<T>) {\r\n\t\tsuper(midIDTagList);\r\n\t\tthis.setRes(midIDTagList.res);\r\n\t\tthis.midIDTagList = midIDTagList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDTagList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\tlet {midTag} = this.midIDTagList;\r\n\t\tlet cSelect = new CSelect(this, item, midTag);\r\n\t\tcSelect.start();\r\n\t}\r\n\r\n\tprotected renderItem(itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\t\treturn renderItemTags(this.midIDTagList, itemTags, index);\r\n\t}\r\n\r\n\tasync onTagSelectChanged(item:any, tag:Tag, selected:boolean) {\r\n\t\tawait this.midIDTagList.onTagSelectChanged(item, tag, selected);\r\n\t}\r\n}\r\n\r\nexport class MidIDTagList<T extends IDBase> extends MidList<ItemTags<T>> {\r\n\treadonly midTag: MidTag;\r\n\tprivate itemTagsColl:{[id:number]:ItemTags<T>};\r\n\trenderTags: (types:Tag[]) => JSX.Element;\r\n\tconstructor(midTag:MidTag) {\r\n\t\tsuper(midTag.uq, undefined);\r\n\t\tthis.midTag = midTag;\r\n\t\tthis.createPageItems();\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected createPageItems():ItemTagsListPageItems<T> {\r\n\t\tlet listPageItems = new ItemTagsListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tkey:((item:ItemTags<T>) => number|string) = item => item.item.id;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<ItemTags<T>[]> {\r\n\t\tlet result = await this.uq.IDxID<T, any>({\r\n\t\t\tID: this.midTag.ID,\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tID2: this.midTag.tag,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\tlet [ret, ret2] = result;\r\n\t\tlet itemTagsList:ItemTags<T>[] = [];\r\n\t\tthis.itemTagsColl = {}\r\n\t\tfor (let item of ret) {\r\n\t\t\tlet p:ItemTags<T> = {item, typeArr:[], typeColl:{}};\r\n\t\t\tthis.itemTagsColl[item.id] = p;\r\n\t\t\titemTagsList.push(p);\r\n\t\t}\r\n\t\tfor (let tagItem of ret2) {\r\n\t\t\tlet {$xid, parent, id} = tagItem;\r\n\t\t\tlet itemTags = this.itemTagsColl[$xid];\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t\t/*\r\n\t\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\t\tlet type = typeColl[parent];\r\n\t\t\tlet midType = this.midTag.typeColl[parent];\r\n\t\t\tif (type === undefined) {\r\n\t\t\t\ttype = {id:midType.id, name:midType.name, sub:[], parent:undefined};\r\n\t\t\t\ttypeColl[parent] = type;\r\n\t\t\t\ttypeArr.push(type);\r\n\t\t\t}\r\n\t\t\ttype.sub.push(midType.sub.find(v => v.id === id));\r\n\t\t\t*/\r\n\t\t}\r\n\t\treturn itemTagsList;\r\n\t}\r\n\r\n\tprivate addTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet midType = this.midTag.typeColl[typeId];\r\n\t\tlet type = typeColl[typeId];\r\n\t\tlet tag = midType.sub.find(v => v.id === tagId);\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = observable.object({id:midType.id, name:midType.name, sub:[tag], parent:undefined});\r\n\t\t\ttypeColl[typeId] = type;\r\n\t\t\ttypeArr.push(type);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttype.sub.push(tag);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate delTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet type = typeColl[typeId];\r\n\t\tif (type === undefined) return;\r\n\t\tlet {sub} = type;\r\n\t\tlet index = sub.findIndex(v => v.id === tagId);\r\n\t\tif (index < 0) return;\r\n\t\tsub.splice(index, 1);\r\n\t\tif (sub.length === 0) {\r\n\t\t\tlet typeIndex = typeArr.findIndex(v => v.id === type.id);\r\n\t\t\tif (typeIndex >= 0) typeArr.splice(typeIndex, 1);\r\n\t\t\tdelete typeColl[typeId];\r\n\t\t}\r\n\t}\r\n\r\n\tonTagSelectChanged = async (itemTags:ItemTags<T>, tag:Tag, selected:boolean) => {\r\n\t\tlet {item} = itemTags;\r\n\t\tlet {id:itemId} = item;\r\n\t\tlet {id, parent} = tag;\r\n\t\tlet ix:IXBase = {ix:undefined, xi:id};\r\n\t\tlet acts:{[name:string]: IXBase[]} = {};\r\n\t\tacts[this.midTag.tag.name] = [ix];\r\n\t\tif (selected === true) {\r\n\t\t\tix.id = itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tix.id = -itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.delTag(itemTags, parent, id);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass ItemTagsListPageItems<T extends IDBase> extends ListPageItems<ItemTags<T>> {\r\n\titemId(item:ItemTags<T>):number {return item.item.id}\r\n\tnewItem(id:number, itemTags:ItemTags<T>):ItemTags<T> {\r\n\t\tlet {item, typeArr, typeColl} = itemTags;\r\n\t\treturn {\r\n\t\t\titem: {...item, id},\r\n\t\t\ttypeArr,\r\n\t\t\ttypeColl,\r\n\t\t}\r\n\t}\r\n\tupdate(item: ItemTags<T>):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { LMR, VPage } from \"tonva-react\";\r\nimport { CTagIDList } from \"./CTagIDList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport class VTags extends VPage<CTagIDList<any>> {\r\n\tprivate tags: Tag[] = [];\r\n\r\n\theader() {return 'tags'}\r\n\tcontent() {\r\n\t\tlet {midTag} = this.controller;\r\n\t\tlet {typeArr} = midTag;\r\n\t\tlet left = <button className=\"btn btn-primary\" \r\n\t\t\tonClick={() => this.controller.showID(this.tags)}>\r\n\t\t\t查看\r\n\t\t</button>;\r\n\t\tlet right = <>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-primary mr-3\" onClick={()=>this.allTags(true)}>全选</button>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-info\" onClick={()=>this.allTags(false)}>全清</button>\r\n\t\t</>;\r\n\t\treturn <div className=\"px-3\" id=\"$all$tags$\">\r\n\t\t\t{typeArr.map(v => this.renderType(v))}\r\n\t\t\t<div className=\"border-top py-3\">\r\n\t\t\t\t<LMR left={left} right={right} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate allTags = (selected:boolean) => {\r\n\t\tlet el = document.getElementById('$all$tags$');\r\n\t\tlet checkInputs = el.getElementsByTagName('input');\r\n\t\tfor (let i=0; i<checkInputs.length; i++) {\r\n\t\t\tlet checkInput = checkInputs[i];\r\n\t\t\tcheckInput.checked = selected;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderType(type: Tag) {\r\n\t\tlet {id, name, sub}  = type;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{sub.map(v => {\r\n\t\t\t\tlet {id, name} = v;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.onTagSelectChanged(evt, v)}\r\n\t\t\t\t\t\t />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onTagSelectChanged(evt: React.ChangeEvent<HTMLInputElement>, tag:Tag) {\r\n\t\tif (evt.currentTarget.checked === true) {\r\n\t\t\tthis.tags.push(tag);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet index = this.tags.findIndex(v => v === tag);\r\n\t\t\tif (index >= 0) this.tags.splice(index, 1);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { listRight } from \"../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { CID, MidID, MidIDList } from \"../ID\";\r\nimport { VTags } from \"./VTags\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class CTagIDList<T extends IDBase> extends  Controller {\r\n\treadonly midTag: MidTag;\r\n\tconstructor(midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.midTag.init();\r\n\t\tthis.openVPage(VTags);\r\n\t}\r\n\r\n\tasync showID(tags: Tag[]) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet midIDList: MidTagIDList<T> = new MidTagIDList<any>(\r\n\t\t\tthis.midTag, tags.map(v => v.id)\r\n\t\t);\r\n\t\tlet cShowTagIDList = new CShowTagIDList(midIDList);\r\n\t\tawait cShowTagIDList.start();\r\n\t}\r\n}\r\n\r\nclass CShowTagIDList<T extends IDBase> extends CList<T> {\r\n\tprotected midIDList: MidTagIDList<T>;\r\n\tconstructor(midIDList: MidTagIDList<T>) {\r\n\t\tsuper(midIDList);\r\n\t\tthis.midIDList = midIDList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async onItemClick(item:any):Promise<void> {\r\n\t\tlet {midTag} = this.midIDList;\r\n\t\tlet mid = new MidID(midTag.uq, {ID: midTag.ID});\r\n\t\tawait mid.init();\r\n\t\tlet cID = new CID(mid);\r\n\t\tcID.onItemClick(item);\r\n\t\t//let cSelect = new CSelect(this, item, midTag, this.res);\r\n\t\t//cSelect.start();\r\n\t}\r\n\t\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\tlet {onRightClick, renderRight} = this.midIDList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:T, index:number):JSX.Element {\r\n\t\tlet {midTag, renderItem} = this.midIDList;\r\n\t\tlet {ID} = midTag;\r\n\t\t//let {item, typeArr} = itemTags;\r\n\t\treturn (renderItem ??  ID.render)(item, index);\r\n\t\t//return renderItemTags(this.props, itemTags, index);\r\n\t}\r\n}\r\n\r\nexport class MidTagIDList<T extends IDBase> extends MidIDList<T> {\r\n\treadonly midTag: MidTag;\r\n\treadonly ids: number[];\r\n\tconstructor(midTag:MidTag, ids:number[]) {\r\n\t\tlet {uq, ID} = midTag;\r\n\t\tsuper(uq, ID);\r\n\t\tthis.ids = ids;\r\n\t}\r\n \r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet result = await this.uq.IXr<T>({\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ids,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n}\r\n","import { IDUI, Uq } from \"tonva-react\";\r\nimport { Detail, Master, Mid } from \"../base\";\r\n\r\nexport interface SheetUI {\r\n\tmaster: IDUI;\r\n\tdetail: IDUI;\r\n}\r\n\r\nexport class MidSheet<M extends Master, D extends Detail> extends Mid {\r\n\treadonly master: IDUI;\r\n\treadonly detail: IDUI;\r\n\r\n\tconstructor(uq:Uq, ui: SheetUI, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tlet {master, detail} = ui;\r\n\t\tthis.master = master;\r\n\t\tthis.detail = detail;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n\r\n\tasync load(id:number):Promise<[M[],D[]]> {\r\n\t\treturn [[], []];\r\n\t}\r\n\r\n\tasync save(master:M, details:D[]):Promise<any> {\r\n\t\tlet ret = await this.uq.ActDetail({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: this.master.ID,\r\n\t\t\t\tvalue: master,\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: this.detail.ID,\r\n\t\t\t\tvalues: details,\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n};\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { createPickId } from \"../select\";\r\nimport { CFormPage, FormUI } from \"../form\";\r\nimport { Detail, Master } from \"../base\";\r\nimport { MidSheet } from \"./MidSheet\";\r\n\r\nexport abstract class CSheet<M extends Master, D extends Detail> extends Controller {\r\n\treadonly midSheet: MidSheet<M, D>;\r\n\tid: number;\r\n\tmaster: M = null;\r\n\tdetails: D[] = [];\r\n\tdetail: D = null;\r\n\r\n\tconstructor(mid: MidSheet<M, D>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmaster: observable,\r\n\t\t\tdetails: observable,\r\n\t\t});\r\n\t\tthis.setRes(mid.res);\r\n\t\tthis.midSheet = mid;\r\n\t}\r\n\r\n\tprotected async load(id:number) {\r\n\t\tthis.id = id;\r\n\t\tlet [master, details] = await this.midSheet.load(id);\r\n\t\tthis.master = master[0];\r\n\t\tthis.details = details;\r\n\t}\r\n\r\n\tasync saveSheet() {\r\n\t\tlet ret = await this.midSheet.save(this.master, this.details);\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tafterMasterNew() {\r\n\r\n\t}\r\n\r\n\tprivate serial:number = 1;\r\n\teditDetail = async (detail: D) => {\r\n\t\tlet {uq, detail:detailFormUI} = this.midSheet;\r\n\t\tlet {ID, fieldCustoms} = detailFormUI;\r\n\t\tlet uiForm = new FormUI(ID.ui, fieldCustoms);\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tuiForm.setIDUi(i, createPickId(uq, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tuiForm.hideField('master', 'row');\r\n\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\tcForm.onSubmit = async (name:string, context: Context) => {\r\n\t\t\tlet values = context.data;\r\n\t\t\tlet serial = values['#'];\r\n\t\t\tif (!serial) {\r\n\t\t\t\tvalues['#'] = this.serial++;\r\n\t\t\t\tthis.details.push(values);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet index = this.details.findIndex(v => (v as any)['#'] === serial);\r\n\t\t\t\tif (index >= 0) {\r\n\t\t\t\t\tObject.assign(this.details[index], values);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.closePage();\r\n\t\t\tif (detail === undefined) {\r\n\t\t\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\t\t\tawait cForm.start();\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait cForm.start();\r\n\t}\r\n}\r\n","import { FA, List, LMR, Page, VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetEdit extends VPage<CSheet<any, any>> {\r\n\theader() {return 'sheet';}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-primary btn-sm mr-2\"\r\n\t\t\tonClick={this.saveSheet}>\r\n\t\t\t整单完成\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master, details} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\tlet right = <button className=\"btn btn-success btn-sm\"\r\n\t\t\tonClick={() => this.controller.editDetail(undefined)}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{ID.render(master)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mt-3 pb-1 mb-1 px-3 small text-muted border-bottom\">\r\n\t\t\t\t<LMR right={right} className=\"align-items-end\">明细</LMR>\r\n\t\t\t</div>\r\n\t\t\t<List items={details} item={{render: this.renderDetail, onClick: this.onDetailClick}} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onDetailClick = (item: any) => {\r\n\t\tthis.controller.editDetail(item);\r\n\t}\r\n\r\n\tprivate renderDetail = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.midSheet.detail.ID.render(item)}\r\n\t\t</div>\r\n\t}\r\n//\t{JSON.stringify(item)}\r\n\r\n\tprivate saveSheet = async () => {\r\n\t\tlet ret = await this.controller.saveSheet();\r\n\t\tthis.closePage();\r\n\t\tthis.openPageElement(<Page header=\"单据完成\">\r\n\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t<div className=\"my-3\">单据保存成功！</div>\r\n\t\t\t\t<div className=\"my-3\">{ret.master}</div>\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={()=>this.closePage()}>返回</button>\r\n\t\t\t</div>\r\n\t\t</Page>)\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetView extends VPage<CSheet<any, any>> {\r\n\theader() {return this.controller.midSheet.master.ID.ui.label}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{ID.render(master)}\r\n\t\t</div>;\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoles } from \"./CRoles\";\r\n\r\ninterface RoleItem {\r\n\tcaption: string;\r\n\tonClick: () => Promise<void>;\r\n}\r\n\r\nexport class VRoles extends VPage<CRoles> {\r\n\tprivate onRoleAdmin = async () => {\r\n\t\tthis.controller.showRoleAdmin();\r\n\t}\r\n\tprivate onAccountant = async () => {\r\n\t\t//this.openVPage(VAccountant);\r\n\t}\r\n\r\n\tprivate onManager = async () => {\r\n\t\t//this.openVPage(VManager);\r\n\t}\r\n\tprivate roleItems:{[role:string]: RoleItem} = {\r\n\t\t$: {\r\n\t\t\tcaption: '设置用户角色',\r\n\t\t\tonClick: this.onRoleAdmin,\r\n\t\t},\r\n\t\taccountant: {\r\n\t\t\tcaption: '会计',\r\n\t\t\tonClick: this.onAccountant,\r\n\t\t},\r\n\t\tmanager: {\r\n\t\t\tcaption: '经理',\r\n\t\t\tonClick: this.onManager,\r\n\t\t},\r\n\t};\r\n\r\n\theader() {\r\n\t\treturn this.t('backend')\r\n\t}\r\n\tcontent() {\r\n\t\tlet VContent = observer(() => {\r\n\t\t\tlet {roles} = this.controller;\r\n\t\t\treturn <div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{roles.map(this.renderRoleItem)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <VContent />;\r\n\t}\r\n\r\n\tprivate renderRoleItem = (role:string, index:number):JSX.Element => {\r\n\t\tlet item = this.roleItems[role];\r\n\t\tif (!item) return null;\r\n\t\tlet {caption, onClick} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={onClick}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{caption}</div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { Form, ItemSchema, VPage, StringSchema, ButtonSchema, UiButton, UiTextItem, Context } from \"tonva-react\";\r\nimport { CRoleAdmin } from \"./CRoleAdmin\";\r\n\r\nexport class VAddUser extends VPage<CRoleAdmin> {\r\n\theader() {return '新增角色用户'}\r\n\tcontent() {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{ name: 'userName', required: true, type: 'string', maxLength: 60 } as StringSchema,\r\n\t\t\t{ name: 'ok', type: 'button' } as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuserName: { widget: 'text', label:'用户账号', placeholder: '请输入用户的账号' } as UiTextItem,\r\n\t\t\t\tok: { widget: 'button', className: 'btn btn-primary', label: '提交' } as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onClick} onEnter={this.onEnter} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onClick = async (name:string, context: Context) => {\r\n\t\tlet error = await this.controller.newUser(context.data['userName']);\r\n\t\tif (error) {\r\n\t\t\tcontext.setError('userName', error);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onEnter = async (name:string, context: Context) => {\r\n\t\tawait this.onClick(name, context);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoleAdmin, UserRole } from \"./CRoleAdmin\";\r\nimport { VAddUser } from \"./VAddUser\";\r\n\r\nexport class VRoleAdmin extends VPage<CRoleAdmin> {\r\n\theader() {return '设置用户角色'}\r\n\tcontent() {\r\n\t\tlet {userRoles} = this.controller;\r\n\t\tlet VItem = observer((v:{userRole:UserRole;isMe:boolean}) => this.renderItem(v.userRole, v.isMe));\r\n\t\tlet VUserRoles = observer(() => <>{\r\n\t\t\tuserRoles.map(v => {\r\n\t\t\t\treturn <VItem key={v.user} userRole={v} isMe={false} />;\r\n\t\t\t})\r\n\t\t}</>);\r\n\t\tlet MeItem = observer(() => <VItem userRole={this.controller.meRoles} isMe={true} />);\r\n\t\treturn <div>\r\n\t\t\t<div className=\"mx-3 mt-3 mb-1 d-flex align-items-end\">\r\n\t\t\t\t<div className=\"mr-auto\">用户角色</div>\r\n\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={()=>this.openVPage(VAddUser)}><FA name=\"plus\" /> 增加</button>\r\n\t\t\t</div>\r\n\t\t\t<MeItem />\r\n\t\t\t<VUserRoles />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (userRole: UserRole, isMe: boolean) => {\r\n\t\tif (!userRole) return null;\r\n\t\tlet {user, roles, isDeleted} = userRole;\r\n\t\tlet {roleCaptions, ixOfUsers} = this.controller;\r\n\t\tlet onUndo = () => this.controller.restoreUser(userRole);\r\n\t\tlet onDelete = () => this.controller.deleteUser(userRole);\r\n\t\tlet onRightClick: () => void;\r\n\t\tlet rightIcon:string;\r\n\t\tlet vUser = this.renderUser(user);\r\n\t\tlet cn = 'bg-white border-top ';\r\n\t\tif (isMe === true) {\r\n\t\t\tcn += 'mb-1';\r\n\t\t\tvUser = <>{vUser}<small className=\"ml-1 text-success\">[自己]</small></>;\r\n\t\t}\r\n\t\tif (isDeleted === true) {\r\n\t\t\tonRightClick = onUndo;\r\n\t\t\trightIcon = 'undo';\r\n\t\t\tvUser = <del>{vUser}</del>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tonRightClick = onDelete;\r\n\t\t\trightIcon = 'times';\r\n\t\t}\r\n\t\tlet right = <div className=\"p-3 cursor-pointer text-info\" onClick={onRightClick}><FA name={rightIcon} /></div>;\r\n\t\treturn <LMR key={user} \r\n\t\t\tclassName={cn}\r\n\t\t\tleft = {<div className=\"p-3 w-12c\">{vUser}</div>}\r\n\t\t\tright = {right}\r\n\t\t\t>\t\t\t\r\n\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t{roles.map((v, i) => {\r\n\t\t\t\t\tlet vCap:any = roleCaptions[i];\r\n\t\t\t\t\tif (isDeleted === true) vCap = <del>{vCap}</del>\r\n\t\t\t\t\treturn <label className=\"m-3\" key={i}>\r\n\t\t\t\t\t\t<input className=\"mr-2\" type='checkbox' \r\n\t\t\t\t\t\t\tdisabled={isDeleted} defaultChecked={v} \r\n\t\t\t\t\t\t\tonChange={e => this.onRoleChange(e, i, userRole)} />\r\n\t\t\t\t\t\t{vCap}\r\n\t\t\t\t\t</label>;\r\n\t\t\t\t})}\r\n\t\t\t\t{\r\n\t\t\t\t\tixOfUsers?.map(v => {\r\n\t\t\t\t\t\treturn <button key={v} onClick={() => this.controller.ixUserBind(user, v)}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-info mx-3 my-2\">\r\n\t\t\t\t\t\t\t<small>关联</small> {v}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate async onRoleChange(event: React.ChangeEvent<HTMLInputElement>, iRole: number, userRole:UserRole) {\r\n\t\tlet {target} = event;\r\n\t\ttarget.disabled = true;\r\n\t\tawait this.controller.setUserRole(target.checked, iRole, userRole);\r\n\t\ttarget.disabled = false;\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { centerApi, Controller, UqApi, Uq } from \"tonva-react\";\r\nimport { CIXEdit, MidIX } from \"../../IX\";\r\nimport { VRoleAdmin } from \"./VRoleAdmin\";\r\n\r\nexport interface UserRole {\r\n\tuser:number; \r\n\troles:boolean[];\r\n\tisDeleted?: boolean;\r\n}\r\n\r\nexport class CRoleAdmin extends Controller {\r\n\tprivate readonly uq:Uq;\r\n\tprivate readonly uqApi: UqApi;\r\n\treadonly allRoles: string[];\r\n\treadonly roleCaptions: string[];\r\n\tmeRoles: UserRole = null;\r\n\tuserRoles: UserRole[] = null;\r\n\tixOfUsers: string[];\r\n\tprivate myRolesChanged:(roles:string[])=>void;\r\n\r\n\tconstructor(uq:Uq, myRolesChanged?:(roles:string[])=>void, roleCaptionMap?:{[role:string]:string}) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmeRoles: observable,\r\n\t\t\tuserRoles: observable,\r\n\t\t});\r\n\t\tthis.uq = uq;\r\n\t\tlet {$:uqMan} = uq;\r\n\t\tthis.uqApi = uqMan.uqApi;\r\n\t\tthis.allRoles = uqMan.allRoles;\r\n\t\tif (!this.allRoles || this.allRoles.length === 0) {\r\n\t\t\tthrow new Error(`uq ${uqMan.name} allRoles not defined. No RoleAdmin needed.`);\r\n\t\t}\r\n\t\tthis.myRolesChanged = myRolesChanged;\r\n\t\tif (roleCaptionMap) {\r\n\t\t\tthis.roleCaptions = this.allRoles.map(v => roleCaptionMap[v] || v);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleCaptions = this.allRoles;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet allUserRoles = await this.uqApi.getAllRoleUsers();\r\n\t\trunInAction(() => {\r\n\t\t\tlet r0 = allUserRoles.shift();\r\n\t\t\tlet {roles} = r0;\r\n\t\t\tif (roles) {\r\n\t\t\t\tthis.ixOfUsers = roles.split('|');\r\n\t\t\t}\r\n\t\t\tlet arr:string[] = this.allRoles.map(v => `|${v}|`);\r\n\t\t\tfunction rolesBool(t:string): boolean[] {\r\n\t\t\t\tif (!t) return arr.map(v => false);\r\n\t\t\t\treturn arr.map(v => t.indexOf(v) >= 0);\r\n\t\t\t}\r\n\t\t\tthis.userRoles = [];\r\n\t\t\tlet meId = this.user.id;\r\n\t\t\tfor (let ur of allUserRoles) {\r\n\t\t\t\tlet {user, roles} = ur;\r\n\t\t\t\tlet item:UserRole = ur as any;\r\n\t\t\t\titem.roles = rolesBool(roles);\r\n\t\t\t\tif (user === meId)\r\n\t\t\t\t\tthis.meRoles = item;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.userRoles.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.openVPage(VRoleAdmin);\r\n\t}\r\n\tasync setUserRole(checked:boolean, iRole:number, userRole:UserRole) {\r\n\t\tlet {roles} = userRole;\r\n\t\tlet len = roles.length;\r\n\t\tlet text:string = '';\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet yes = i===iRole? checked : roles[i];\r\n\t\t\tif (yes === true) text += '|' + this.allRoles[i];\r\n\t\t}\r\n\t\ttext += '|';\r\n\t\tawait this.uqApi.setUserRoles(userRole.user, text);\r\n\t\troles[iRole] = checked;\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tprivate fireMyRolesChanged(userRole: UserRole, newRoles?:boolean[]) {\r\n\t\tif (!this.myRolesChanged) return;\r\n\t\tif (userRole !== this.meRoles) return;\r\n\t\tlet {roles} = userRole;\r\n\t\tif (newRoles) roles = newRoles;\r\n\t\tlet roleNames:string[] = ['$'];\r\n\t\tfor (let i=0; i<roles.length; i++) {\r\n\t\t\tif (roles[i] === true) roleNames.push(this.allRoles[i]);\r\n\t\t}\r\n\t\tthis.myRolesChanged(roleNames);\r\n\t}\r\n\r\n\tprivate buildRolesText(userRole:UserRole) {\r\n\t\tlet ret = userRole.roles.map((v, index) => v===true? this.allRoles[index]:'').join('|');\r\n\t\treturn `|${ret}|`;\r\n\t}\r\n\r\n\tasync newUser(userName: string): Promise<string> {\r\n\t\tlet ret = await centerApi.userFromKey(userName);\r\n\t\tif (!ret) {\r\n\t\t\treturn '这个用户名没有注册';\r\n\t\t}\r\n\t\tlet user = ret.id;\r\n\t\tlet roles: string;\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tif (this.meRoles) {\r\n\t\t\t\tthis.meRoles.isDeleted = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.meRoles = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles:  this.allRoles.map(v => false)\r\n\t\t\t\t};\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet userRole = this.userRoles.find(v => v.user === user);\r\n\t\t\tif (userRole) {\r\n\t\t\t\tif (userRole.isDeleted === true) {\r\n\t\t\t\t\tuserRole.isDeleted = false;\r\n\t\t\t\t\troles = this.buildRolesText(userRole);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn '这个用户已经是角色用户了';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuserRole = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles: this.allRoles.map(v => false),\r\n\t\t\t\t};\r\n\t\t\t\tthis.userRoles.push(userRole);\r\n\t\t\t\troles = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tthis.fireMyRolesChanged(this.meRoles);\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = true; \r\n\t\tawait this.uqApi.deleteUserRoles(user);\r\n\t\tthis.fireMyRolesChanged(userRole, this.allRoles.map(v => false));\r\n\t}\r\n\r\n\tasync restoreUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = false; \r\n\t\tlet roles = this.buildRolesText(userRole)\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tixUserBind = async (user:number, ixName:string) => {\r\n\t\tlet IX = this.uq.$.getIX(ixName);\r\n\t\tawait IX.loadSchema();\r\n\t\tlet {id2Name} = IX.schema;\r\n\t\tlet ID = this.uq.$.getID(id2Name);\r\n\t\tlet midIX = new MidIX(this.uq, IX, ID, user);\r\n\t\tlet cIXEdit = new CIXEdit(midIX);\r\n\t\tawait cIXEdit.start();\r\n\t}\r\n}\r\n","import { Controller, nav, Uq } from \"tonva-react\";\r\nimport { VRoles } from \"./VRoles\";\r\nimport { CRoleAdmin } from './roleAdmin';\r\n\r\nconst roleCaptionMap:{[role:string]: string} = {\r\n\taccountant: '会计',\r\n\tmanager: '经理',\r\n}\r\n\r\nexport class CRoles extends Controller {\r\n\tprivate uq: Uq;\r\n\troles: string[] = null;\r\n\tconstructor(uq:Uq) {\r\n\t\tsuper();\t\t\r\n\t\tthis.uq = uq;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.roles = await this.uq.$.getRoles();\r\n\t\tif (!this.roles) this.roles = [];\r\n\t\tthis.openVPage(VRoles)\r\n\t}\r\n\r\n\tasync showRoleAdmin() {\r\n\t\tlet  uqMan = this.uq.$;\r\n\t\tlet {allRoles} = uqMan;\r\n\t\tif (!allRoles || allRoles.length === 0) {\r\n\t\t\talert(`uq ${uqMan.name} has not defined roles`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cRoleAdmin = new CRoleAdmin(this.uq, this.myRolesChanged, roleCaptionMap);\r\n\t\tcRoleAdmin.setRes(this.getRes());\r\n\t\tawait cRoleAdmin.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles:string[]) => {\r\n\t\tthis.roles = roles;\r\n\t\tthis.user.roles[this.uq.$.name] = roles;\r\n\t\tnav.saveLocalUser();\r\n\t}\r\n}","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe, makeObservable} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n\t\tsuper(list);\r\n\t\tmakeObservable(this, {\r\n\t\t\t_items: observable\r\n\t\t})\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n\tprivate get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n\trender = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\t//private loading:boolean = false;\r\n\t//private loadingIds: number[];\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n\t\treturn;\r\n    }\r\n\t/*\r\n\tprotected removeWaiting(id:number) {\r\n\t\tlet index = this.waitingIds.findIndex(v => v === id);\r\n\t\tthis.waitingIds.splice(index, 1);\r\n\t}\r\n\t\r\n\tprotected clearWaiting() {\r\n\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t}\r\n\t\r\n\tprotected removeLoading(id:number) {\r\n\t\tif (this.loadingIds === undefined) return;\r\n\t\tlet index = this.loadingIds.findIndex(v => v === id);\r\n\t\tthis.loadingIds.splice(index, 1);\r\n\t}\r\n\t*/\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n\t\treturn this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n\t\t/*\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n\t\t*/\r\n\t\t//this.removeWaiting(id);\r\n\t\t//this.removeLoading(id);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        //if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\t/*\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\t//this.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\tthis.clearWaiting();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.waitingIds.length === 0) return;\r\n\t\t//if (this.loading === true) return;\r\n\t\t//this.loading = true;\r\n\t\tlet loadingIds = [...this.waitingIds];\r\n\t\t//this.clearWaiting();\r\n\t\tthis.waitingIds = [];\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(loadingIds);\r\n\t\t//this.loading = false;\r\n\t\t//this.loadingIds = undefined;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(undefined, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n\t\tlet netRet = await this.loadTuidIds(netIds);\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t//有些id可能没有内容，不会返回\r\n\t\t\t//let id = netIds[i]; \r\n\t\t\tlet row:string = netRet[i];\r\n\t\t\tif (!row) continue;\r\n\t\t\tlet p = row.indexOf('\\t');\r\n\t\t\tif (p < 0) p = row.length;\r\n\t\t\tlet id = Number(row.substr(0, p));\r\n\t\t\t_.remove(netIds, v => v === id);\r\n\t\t\tret.push(row);\r\n\t\t\tthis.localArr.setItem(id, row);\r\n\t\t}\r\n\t\tlen = netIds.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tthis.localArr.setItem(netIds[i], '');\r\n\t\t}\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import fs from \"fs\";\r\nimport { capitalCase } from \"../../tool\";\r\nimport { FieldItem } from \"../../ui\";\r\nimport { ID, IDX, IX } from \"../ID\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { buildUQ } from \"./buildUQ\";\r\nimport { buildFieldItem } from \"./fieldItem\";\r\nimport { buildTsHeader, overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\n\r\nexport function buildTsUqFolder(uq: UqMan, uqsFolder:string, uqAlias:string) {\r\n\tlet uqFolder = uqsFolder + '/' + uqAlias;\r\n\tif (fs.existsSync(uqFolder) === false) {\r\n\t\tfs.mkdirSync(uqFolder);\r\n\t}\r\n\tlet tsUq = buildTsHeader();\r\n\ttsUq += buildUQ(uq, uqAlias);\r\n\toverrideTsFile(`${uqFolder}/${uqAlias}.ts`, tsUq);\r\n\tsaveTsIndexAndRender(uqFolder, uq, uqAlias);\r\n}\r\n\r\nfunction saveTsIndexAndRender(uqFolder:string, uq: UqMan, uqAlias:string) {\r\n\tlet imports = '', sets = '';\r\n\tlet {idArr, idxArr, ixArr} = uq;\r\n\tfor (let i of [...idArr, ...idxArr, ...ixArr]) {\r\n\t\tlet cName = capitalCase(i.name);\r\n\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\tsets += `\\n\tObject.assign(uq.${cName}, ${cName});`;\r\n\r\n\t\tlet tsUI = `import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { ${cName} } from \"./${uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\tlet fields = buildFields(i);\r\n\t\tlet tsFieldArr:string = buildFieldArr(i);\r\n\r\n\t\treplaceTsFileFields(path, fields);\r\n\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\tlet tsImportFieldItemsEnd = ' } from \"tonva-react\";';\r\n\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNum, FieldItemString, FieldItemId';\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{\r\n\t\t\t\tbegin: tsImportFieldItemsBegin, \r\n\t\t\t\tend: tsImportFieldItemsEnd, \r\n\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t}\r\n\t\t);\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{begin:'\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content:tsFieldArr}\r\n\t\t);\r\n\t}\r\n\r\n\tlet tsIndex = `import { UqExt as Uq } from './${uqAlias}';${imports}\r\n\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${uqAlias}';\r\n`;\r\n\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n}\r\n\r\nfunction buildFields(i:ID|IDX|IX):{[name:string]:FieldItem} {\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': return buildIDFields(i as ID);\r\n\t\tcase 'idx': return buildIDXFields(i);\r\n\t\tcase 'ix': return buildIXFields(i);\r\n\t}\r\n};\r\n\r\nfunction buildIDFields(ID:ID):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = ID;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n}\r\nfunction buildIDXFields(IDX:IDX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IDX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildIXFields(IX:IX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildFieldArr(i:ID|IDX|IX):string {\r\n\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': ts += buildIDFieldArr(i as ID); break;\r\n\t\tcase 'idx': ts += buildIDXFieldArr(i); break;\r\n\t\tcase 'ix': ts += buildIXFieldArr(i); break;\r\n\t}\r\n\treturn ts += '\\n];\\n';\r\n}\r\nfunction buildIDFieldArr(i:ID):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIDXFieldArr(i:IDX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIXFieldArr(i:IX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'ix') continue;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction replaceTsFileFields(path: string, fields:{[name:string]:FieldItem}) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet startStr = '\\n/*--fields--*/';\r\n\tlet endStr = '\\n/*==fields==*/\\n';\r\n\tlet start = text.indexOf(startStr);\r\n\tif (start > 0) {\r\n\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\tif (end > 0) {\r\n\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\tlet oldText = text.substring(lBrace, rBrace+1);\r\n\t\t\tlet fieldsText = buildFieldsFromOldText(fields, oldText);\r\n\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t+ fieldsText\r\n\t\t\t\t+ '\\n};'\r\n\t\t\t\t+ text.substring(end);\r\n\t\t\tfs.writeFileSync(path, text);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\nfunction buildFieldsFromOldText(fields:{[name:string]:FieldItem}, oldText:string):string {\r\n\tlet ret = '';\r\n\tfor (let i in fields) {\r\n\t\tlet field = fields[i];\r\n\t\tsetFieldOldProp(field, oldText);\r\n\t\tret += buildFieldText(field);\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction setFieldOldProp(field:FieldItem, text:string) {\r\n\tlet fieldStart = field.name + ':';\r\n\tlet start = text.indexOf('\\t' + fieldStart);\r\n\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\tif (start < 0) return;\r\n\t++start;\r\n\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\tif (end < 0) return;\r\n\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t/* eslint no-eval: 0 */\r\n\tlet obj = eval('(' + fieldText + ')');\r\n\tfieldItemReplaceProps.forEach(v => {\r\n\t\tlet prop = obj[v];\r\n\t\tif (!prop) return;\r\n\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t(field as any)[v] = prop;\r\n\t});\r\n}\r\n\r\nfunction buildFieldText(field:FieldItem):string {\r\n\tlet {$FieldItemType} = field as any;\r\n\tdelete (field as any).$FieldItemType;\r\n\tlet ret = '\\n\\t' + field.name + ': ';\r\n\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\tjson = json.replace('}', '\\t}');\r\n\tret += json;\r\n\treturn ret + ' as ' + $FieldItemType + ',';\r\n}\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\nfunction replaceTsFileString(path:string, sec:ReplaceSection) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet {begin, end, content} = sec;\r\n\tlet b = text.indexOf(begin);\r\n\tif (b < 0) return;\r\n\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\tif (e < 0) return;\r\n\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\tfs.writeFileSync(path, text);\r\n}\r\n","import { camelCase, capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { Action } from '../action';\r\nimport { Book } from '../book';\r\nimport { Query } from '../query';\r\nimport { Sheet } from '../sheet';\r\nimport { Tuid } from '../tuid';\r\nimport { UqEnum } from '../enum';\r\nimport { Map } from '../map';\r\nimport { History } from '../history';\r\nimport { Tag } from '../tag';\r\nimport { Pending } from '../pending';\r\nimport { Entity } from '../entity';\r\nimport { ID, IX, IDX } from '../ID';\r\nimport { ArrFields, Field } from '../uqMan';\r\nimport { entityName } from \"./tools\";\r\n\r\nexport function buildUQ(uq:UqMan, uqAlias:string) {\r\n\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\tlet ts:string = `\\n\\n`;\r\n\tts += '\\n//===============================';\r\n\tts += `\\n//======= UQ ${uq.name} ========`;\r\n\tts += '\\n//===============================';\r\n\tts += '\\n';\r\n\t\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n    uq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n    uq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n    uq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n    uq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n    uq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n    uq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n    uq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\tuq.idArr.forEach(v => ts += uqEntityInterface<ID>(v, buildIDInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXActParamInterface));\t\r\n\tuq.ixArr.forEach(v => ts += uqEntityInterface<IX>(v, buildIXInterface));\r\n\r\n\tts += buildActsInterface(uq);\r\n\r\n\tts += `\r\n\\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n`;\r\n\tfunction appendArr<T extends Entity>(arr:T[], type:string, tsBuild: (v:T) => string) {\r\n\t\tif (arr.length === 0) return;\r\n\t\tlet tsLen = ts.length;\r\n\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\tif (ts.length - tsLen > 0) {\r\n\t\t\ttsImport += ', Uq' + type;\r\n\t\t}\r\n\t}\r\n\tappendArr<Tuid>(uq.tuidArr, 'Tuid', v => uqBlock<Tuid>(v, buildTuid));\r\n\tappendArr<Action>(uq.actionArr, 'Action', v => uqBlock<Action>(v, buildAction));\r\n\tappendArr<Sheet>(uq.sheetArr, 'Sheet', v => uqBlock<Sheet>(v, buildSheet));\r\n\tappendArr<Book>(uq.bookArr, 'Book', v => uqBlock<Book>(v, buildBook));\r\n\tappendArr<Query>(uq.queryArr, 'Query', v => uqBlock<Query>(v, buildQuery));\r\n\tappendArr<Map>(uq.mapArr, 'Map', v => uqBlock<Map>(v, buildMap));\r\n\tappendArr<History>(uq.historyArr, 'History', v => uqBlock<History>(v, buildHistory));\r\n\tappendArr<Pending>(uq.pendingArr, 'Pending', v => uqBlock<Pending>(v, buildPending));\r\n\tappendArr<Tag>(uq.tagArr, 'Tag', v => uqBlock<Tag>(v, buildTag));\r\n\tappendArr<ID>(uq.idArr, 'ID', v => uqBlock<ID>(v, buildID));\r\n\tappendArr<IDX>(uq.idxArr, 'IDX', v => uqBlock<IDX>(v, buildIDX));\r\n\tappendArr<IX>(uq.ixArr, 'IX', v => uqBlock<IX>(v, buildIX));\r\n\tts += '\\n}\\n';\r\n\ttsImport += ' } from \"tonva-react\";';\r\n\treturn tsImport + ts;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\n\r\nfunction buildFields(fields: Field[], isInID:boolean = false, indent:number = 1) {\r\n\tif (!fields) return '';\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, isInID, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap:{[type:string]:string} = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'master', 'row', 'no', '$create', '$update', '$owner'];\r\nfunction buildField(field: Field, isInID:boolean, indent:number = 1) {\r\n\tlet {name, type} = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\tlet q:string = (isInID === true && sysFields.indexOf(name) >= 0)? '?' : '';\r\n\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]):string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, false, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\n/*\r\nconst typeMap:{[type:string]:string} = {\r\n\taction: 'Action',\r\n\tquery: 'Query',\r\n}\r\n*/\r\nfunction buildReturns(entity:Entity, returns:ArrFields[]):string {\r\n\tif (!returns) return;\r\n\t//let {typeName} = entity;\r\n\t//let type = typeMap[typeName] || typeName;\r\n\tlet {sName} = entity;\r\n\tsName = capitalCase(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet {schema} = enm;\r\n\tif (!schema) return;\r\n\tlet {values} = schema;\r\n\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\tlet first:boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n}'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet {sName} = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet {sName, verify} = sheet;\r\n\tlet cName = capitalCase(sName);\r\n\tlet v = verify? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet {sName, fields, arrFields, verify} = sheet;\r\n\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet {returns} = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet {name:arrName, fields} = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book):string {\r\n\tlet {sName} = book;\r\n\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBookInterface(book: Book):string {\r\n\tlet {sName, fields, returns} = book;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(book, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMap(map: Map):string {\r\n\tlet {sName} = map;\r\n\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMapInterface(map: Map):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = map;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(map, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildHistory(history: History):string {\r\n\tlet {sName} = history;\r\n\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History):string {\r\n\tlet {sName, fields, returns} = history;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(history, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPending(pending: Pending):string {\r\n\tlet {sName} = pending;\r\n\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = pending;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(pending, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildTag(tag: Tag):string {\r\n\tlet {sName} = tag;\r\n\tlet ts = `\\t${entityName(sName)}: UqTag;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildID(id: ID):string {\r\n\tlet {sName} = id;\r\n\tlet ts = `\\t${entityName(sName)}: UqID<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDX(idx: IDX):string {\r\n\tlet {sName} = idx;\r\n\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIX(ix: IX):string {\r\n\tlet {sName} = ix;\r\n\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildIDInterface(idEntity: ID):string {\r\n\tlet {sName, fields, schema} = idEntity;\r\n\tlet {keys:schemaKeys} = schema;\r\n\tlet keys:Field[] = [], others:Field[] = [];\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\telse others.push(f);\r\n\t}\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += `\\n\\tid?: number;`;\r\n\tts += buildFields(keys, true);\r\n\tts += buildFields(others, true);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\tts += `: ${s};`;\r\n\t}\r\n\r\n\tts += `\\n\\t$act?: number;`;\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXActParamInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\tts += `: ${s}|IDXValue;`;\r\n\t}\r\n\r\n\tts += `\\n\\t$act?: number;`;\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIXInterface(ix: IX):string {\r\n\tlet {sName, fields} = ix;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActsInterface(uq: UqMan) {\r\n\tlet ts = `\\nexport interface ParamActs {`;\r\n\tuq.idArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.idxArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.ixArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tts += '\\n}\\n';\r\n\treturn ts;\r\n}\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { $Piecewise } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Name\"\r\n\t} as undefined,\r\n\tmul: {\r\n\t\t\"name\": \"mul\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Mul\"\r\n\t} as FieldItemInt,\r\n\tdiv: {\r\n\t\t\"name\": \"div\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Div\"\r\n\t} as FieldItemInt,\r\n\toffset: {\r\n\t\t\"name\": \"offset\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Offset\"\r\n\t} as FieldItemInt,\r\n\tasc: {\r\n\t\t\"name\": \"asc\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Asc\"\r\n\t} as undefined,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.name, fields.mul, fields.div, fields.offset, fields.asc, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"$Piecewise\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: $Piecewise):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { $PiecewiseDetail } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tparent: {\r\n\t\t\"name\": \"parent\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Parent\"\r\n\t} as FieldItemId,\r\n\trow: {\r\n\t\t\"name\": \"row\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Row\"\r\n\t} as FieldItemInt,\r\n\tsec: {\r\n\t\t\"name\": \"sec\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Sec\"\r\n\t} as FieldItemInt,\r\n\tvalue: {\r\n\t\t\"name\": \"value\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Value\"\r\n\t} as FieldItemInt,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.parent, fields.row, fields.sec, fields.value, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"$PiecewiseDetail\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: $PiecewiseDetail):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { AccountType } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\ttype: {\r\n\t\t\"name\": \"type\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Type\"\r\n\t} as FieldItemString,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.type, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"AccountType\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: AccountType):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Account } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tuser: {\r\n\t\t\"name\": \"user\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"User\"\r\n\t} as FieldItemId,\r\n\t$owner: {\r\n\t\t\"name\": \"$owner\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"$owner\"\r\n\t} as FieldItemInt,\r\n\t$create: {\r\n\t\t\"name\": \"$create\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"$create\"\r\n\t} as undefined,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.user, fields.$owner, fields.$create, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Account\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Account):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { AccountCTO } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tcommissionFormula: {\r\n\t\t\"name\": \"commissionFormula\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"CommissionFormula\"\r\n\t} as FieldItemId,\r\n\torderAmount: {\r\n\t\t\"name\": \"orderAmount\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"OrderAmount\"\r\n\t} as FieldItemNum,\r\n\torderDeliver: {\r\n\t\t\"name\": \"orderDeliver\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"OrderDeliver\"\r\n\t} as FieldItemNum,\r\n\torderPaid: {\r\n\t\t\"name\": \"orderPaid\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"OrderPaid\"\r\n\t} as FieldItemNum,\r\n\tamount: {\r\n\t\t\"name\": \"amount\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"Amount\"\r\n\t} as FieldItemNum,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.commissionFormula, fields.orderAmount, fields.orderDeliver, fields.orderPaid, fields.amount, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"AccountCTO\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: AccountCTO):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { UserAccountType } from \"./JkMe\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.xi, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"UserAccountType\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: UserAccountType):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","//=== UqApp builder created on Fri Apr 09 2021 16:54:56 GMT-0400 (GMT-04:00) ===//\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva-react';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase<CApp, UQs> {\r\n}\r\n\r\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase<UQs> {\r\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { View } from \"tonva-react\";\r\nimport { CContentManager } from \"./CContentManager\";\r\n\r\nexport class VItem extends View<CContentManager> {\r\n\trender() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t\tCContentManager is me {this.controller.value}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n}","import { VPage } from \"tonva-react\";\r\nimport { CContentManager } from \"./CContentManager\";\r\n\r\nexport class VValuePage extends VPage<CContentManager> {\r\n\theader() {return 'CContentManager'}\r\n}","import { AccountController, CHome } from \"../CHome\";\r\nimport { CApp, CUqSub, UQs } from \"uq-app\";\r\nimport { VItem } from \"./VItem\";\r\nimport { VValuePage } from \"./VValuePage\";\r\nimport { makeObservable, observable } from \"mobx\";\r\n\r\nexport class CContentManager extends CUqSub<CApp, UQs, CHome> implements AccountController {\r\n\tvalue: number = null;\r\n\tconstructor(cHome: CHome) {\r\n\t\tsuper(cHome);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t})\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VValuePage);\r\n\t}\r\n\r\n\trenderItem() {\r\n\t\treturn this.renderView(VItem);\r\n\t}\r\n\r\n\tasync loadItem(): Promise<void> {\r\n\t\tthis.value = 7;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, View } from \"tonva-react\";\r\nimport { CCTO } from \"./CCTO\";\r\n\r\nexport class VItem extends View<CCTO> {\r\n\trender() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\tlet {orderAmountDay, orderAmountWeek, orderAmountMonth/*, orderAmountYear*/} = this.controller;\r\n\t\t\tfunction renderOrderAmount(amount:number, caption: string, color: string) {\r\n\t\t\t\tlet vAmount: any;\r\n\t\t\t\tif (amount === null) {\r\n\t\t\t\t\tvAmount = <FA name='spinner' spin={true} className=\"small text-info\" />;\r\n\t\t\t\t}\r\n\t\t\t\telse if (amount === undefined) {\r\n\t\t\t\t\tvAmount = '-';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvAmount = amount;\r\n\t\t\t\t}\r\n\t\t\t\treturn <div className=\"text-center border rounded m-1 px-2 py-3 w-min-12c\">\r\n\t\t\t\t\t<div className={color}>{caption}订单</div>\r\n\t\t\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t\t\t<small className=\"text-muted\">共</small> \r\n\t\t\t\t\t\t<b className={'mx-2 ' + color}>{vAmount}</b>\r\n\t\t\t\t\t\t<small className=\"text-muted\">元</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\treturn <div className=\"d-block pt-2\">\r\n\t\t\t\t<div className=\"px-3 m-1\">CTO</div>\r\n\t\t\t\t<div className=\"px-3 py-2 d-flex flex-wrap p-1\">\r\n\t\t\t\t\t{renderOrderAmount(orderAmountDay, '日', 'text-danger')}\r\n\t\t\t\t\t{renderOrderAmount(orderAmountWeek, '周', 'text-primary')}\r\n\t\t\t\t\t{renderOrderAmount(orderAmountMonth, '月', 'text-success')}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t\t//{renderOrderAmount(orderAmountYear, '年', 'text-info')}\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, VPage } from \"tonva-react\";\r\nimport { CCTO } from \"./CCTO\";\r\n\r\nexport class VValuePage extends VPage<CCTO> {\r\n\theader() {return 'CTO'}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {allValuesLoaded, orderAmountDay, orderAmountMonth/*, orderAmountYear*/} = this.controller;\r\n\t\t\tif (allValuesLoaded === false) {\r\n\t\t\t\treturn <div className=\"px-5 py-3\">\r\n\t\t\t\t\t<FA name='spinner' spin={true} size=\"2x\" className=\"text-info\" />\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tfunction renderAmount(amount:number, caption: string, color: string) {\r\n\t\t\t\tlet vAmount: any;\r\n\t\t\t\tif (amount === null) {\r\n\t\t\t\t\tvAmount = <FA name='spinner' spin={true} className=\"small text-info\" />;\r\n\t\t\t\t}\r\n\t\t\t\telse if (amount === undefined) {\r\n\t\t\t\t\tvAmount = '-';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvAmount = amount;\r\n\t\t\t\t}\r\n\t\t\t\treturn <div className=\"text-center border rounded m-1 px-2 py-3 w-min-12c\">\r\n\t\t\t\t\t<div className={color}>{caption}</div>\r\n\t\t\t\t\t<div className=\"mt-2\">\r\n\t\t\t\t\t\t<small className=\"text-muted\">共</small> \r\n\t\t\t\t\t\t<b className={'mx-2 ' + color}>{vAmount}</b>\r\n\t\t\t\t\t\t<small className=\"text-muted\">元</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tfunction renderCaption(caption: string) {\r\n\t\t\t\treturn <div className=\"px-3 pt-2 pb-1 border-bottom small text-muted bg-light\">{caption}</div>;\r\n\t\t\t}\r\n\t\t\treturn <div className=\"d-block pt-2 bg-white cursor-pointer\" \r\n\t\t\t\tonClick={this.controller.showIDX}>\r\n\t\t\t\t{renderCaption('订单')}\r\n\t\t\t\t<div className=\"px-3 py-2 d-flex flex-wrap p-1\">\r\n\t\t\t\t\t{renderAmount(orderAmountDay, '日', 'text-danger')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '周', 'text-primary')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '月', 'text-success')}\r\n\t\t\t\t</div>\r\n\t\t\t\t{renderCaption('发货')}\r\n\t\t\t\t<div className=\"px-3 py-2 d-flex flex-wrap p-1\">\r\n\t\t\t\t\t{renderAmount(orderAmountDay, '日', 'text-danger')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '周', 'text-primary')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '月', 'text-success')}\r\n\t\t\t\t</div>\r\n\t\t\t\t{renderCaption('收款')}\r\n\t\t\t\t<div className=\"px-3 py-2 d-flex flex-wrap p-1\">\r\n\t\t\t\t\t{renderAmount(orderAmountDay, '日', 'text-danger')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '周', 'text-primary')}\r\n\t\t\t\t\t{renderAmount(orderAmountMonth, '月', 'text-success')}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n}","import { AccountController, CHome } from \"../CHome\";\r\nimport { CApp, CUqSub, UQs } from \"uq-app\";\r\nimport { AccountCTO } from 'uq-app/uqs/JkMe';\r\nimport { VItem } from \"./VItem\";\r\nimport { VValuePage } from \"./VValuePage\";\r\nimport { action, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { CIDX, MidIDX, TimeSpan } from \"tonva-uqui\";\r\n//import { CList } from \"tonva-uqui/list\";\r\n\r\nexport class CCTO extends CUqSub<CApp, UQs, CHome> implements AccountController {\r\n\tvalue: number = null;\r\n\torderAmountDay: number = null;\r\n\torderAmountWeek: number = null;\r\n\torderAmountMonth: number = null;\r\n\t//orderAmountYear: number = null;\r\n\tallValuesLoaded: boolean = false;\r\n\tconstructor(cHome: CHome) {\r\n\t\tsuper(cHome);\r\n\t\tmakeObservable(this, {\r\n\t\t\tloadItem: action,\r\n\t\t\torderAmountDay: observable,\r\n\t\t\torderAmountMonth: observable,\r\n\t\t\t//orderAmountYear: observable,\r\n\t\t\tallValuesLoaded: observable,\r\n\t\t})\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.allValuesLoaded = false;\r\n\t\tthis.openVPage(VValuePage);\r\n\t\tawait this.loadItem();\r\n\t\tthis.allValuesLoaded = true;\r\n\t}\r\n\r\n\trenderItem() {\r\n\t\treturn this.renderView(VItem);\r\n\t}\r\n\r\n\tasync loadItem(): Promise<void> {\r\n\t\tlet timeSpanDay = TimeSpan.create('day');\r\n\t\tlet timeSpanWeek = TimeSpan.create('week');\r\n\t\tlet timeSpanMonth = TimeSpan.create('month');\r\n\t\t//let timeSpanYear = TimeSpan.create('year');\r\n\t\tlet me = this.uqs.JkMe;\r\n\t\tlet id = this.owner.accountId;\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tme.IDSum<AccountCTO>({\r\n\t\t\t\tIDX: me.AccountCTO,\r\n\t\t\t\tfield: ['orderAmount'],\r\n\t\t\t\tid,\r\n\t\t\t\tfar: timeSpanDay.far,\t\t\t\t// 以前\r\n\t\t\t\tnear: timeSpanDay.near,\t\t\t\t// 最近\r\n\t\t\t}),\r\n\t\t\tme.IDSum<AccountCTO>({\r\n\t\t\t\tIDX: me.AccountCTO,\r\n\t\t\t\tfield: ['orderAmount'],\r\n\t\t\t\tid,\r\n\t\t\t\tfar: timeSpanWeek.far,\t\t\t\t// 以前\r\n\t\t\t\tnear: timeSpanWeek.near,\t\t\t\t// 最近\r\n\t\t\t}),\r\n\t\t\tme.IDSum<AccountCTO>({\r\n\t\t\t\tIDX: me.AccountCTO,\r\n\t\t\t\tfield: ['orderAmount'],\r\n\t\t\t\tid,\r\n\t\t\t\tfar: timeSpanMonth.far,\t\t\t\t// 以前\r\n\t\t\t\tnear: timeSpanMonth.near,\t\t\t\t// 最近\r\n\t\t\t}),\r\n\t\t\t/*\r\n\t\t\tme.IDSum<AccountCTO>({\r\n\t\t\t\tIDX: me.AccountCTO,\r\n\t\t\t\tfield: ['orderAmount'],\r\n\t\t\t\tid,\r\n\t\t\t\tfar: timeSpanYear.far,\t\t\t\t// 以前\r\n\t\t\t\tnear: timeSpanYear.near,\t\t\t\t// 最近\r\n\t\t\t}),\r\n\t\t\t*/\r\n\t\t]);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.orderAmountDay = ret[0][0]?.orderAmount;\r\n\t\t\tthis.orderAmountWeek = ret[1][0]?.orderAmount;\r\n\t\t\tthis.orderAmountMonth = ret[2][0]?.orderAmount;\r\n\t\t\t//this.orderAmountYear = ret[3][0]?.orderAmount;\r\n\t\t});\r\n\t}\r\n\r\n\tshowIDX = async () => {\r\n\t\tlet uq = this.uqs.JkMe;\r\n\t\tlet mid = new MidIDX(uq, uq.AccountCTO, uq.Account, this.timeZone);\r\n\t\tlet cIDX = new CIDX(mid);\r\n\t\t//await cIDX.start();\r\n\t\tlet ret = await uq.QueryID<any>({\r\n\t\t\tID: uq.Account,\r\n\t\t\tIDX: [uq.AccountCTO],\r\n\t\t\tkey: {user: undefined},\r\n\t\t});\r\n\t\tif (ret.length === 0) {\r\n\t\t\talert('QUERY ID return nothing!');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tawait cIDX.showItemView(ret[0]);\r\n\t\t/*\r\n\t\tlet midIDXList = new MidIDXList(uq, uq.Account, uq.AccountCTO);\r\n\t\tmidIDXList.onItemClick = (item:any) => cIDX.start(item);\r\n\t\tlet idList = new CList(midIDXList);\r\n\t\tawait idList.start();\r\n\t\t*/\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, VPage } from \"tonva-react\";\r\nimport { AccountController, CHome } from \"./CHome\";\r\nimport '../App.css';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\theader() {return '首页'}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t<List items={this.controller.accountControllers} \r\n\t\t\t\t\titem={{render: this.renderAccountType, onClick: this.onClickAccountType}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderAccountType = (accountController: AccountController, index: number) => {\r\n\t\treturn accountController.renderItem();\r\n\t}\r\n\r\n\tprivate onClickAccountType = async (accountController: AccountController) => {\r\n\t\tawait accountController.start();\r\n\t}\r\n}","import { makeObservable, observable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Account, AccountType } from \"uq-app/uqs/JkMe\";\r\nimport { CContentManager } from \"./contentManager\";\r\nimport { CCTO } from \"./cto\";\r\nimport { VHome } from \"./VHome\";\r\n\r\nexport interface AccountController {\r\n\tstart(): Promise<void>;\r\n\tloadItem(): Promise<void>;\r\n\trenderItem():JSX.Element;\t\r\n}\r\n\r\nexport class CHome extends CUqBase {\r\n\t//accountTypes: AccountType[];\r\n\t//cCTO: CCTO;\r\n\taccountId: number;\r\n\taccountControllers: AccountController[];\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\taccountControllers: observable\r\n\t\t});\r\n\t\t//this.cCTO = this.newSub(CCTO);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VHome);\r\n\r\n\tload = async () => {\r\n\t\tlet me = this.uqs.JkMe;\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tme.QueryID<Account>({\r\n\t\t\t\tIDX: [me.Account],\r\n\t\t\t\tkeyx: {user:undefined, accounType: undefined},\r\n\t\t\t}),\r\n\t\t\tme.QueryID<AccountType>({\r\n\t\t\t\tIX: [me.UserAccountType],\r\n\t\t\t\tIDX: [me.AccountType],\r\n\t\t\t\tix: undefined,\r\n\t\t\t}),\r\n\t\t]);\r\n\t\tlet account = ret[0];\r\n\t\tlet accounType = ret[1];\r\n\r\n\t\tthis.accountId = account[0]?.id;\r\n\t\tthis.accountControllers = accounType.map(v => {\r\n\t\t\tswitch(v.type) {\r\n\t\t\t\tdefault:\r\n\t\t\t\tcase 'cto': return this.newSub(CCTO);\r\n\t\t\t\tcase 'contentmanager': return this.newSub(CContentManager);\r\n\t\t\t}\r\n\t\t});\r\n\t\tawait Promise.all(this.accountControllers.map(v => v.loadItem()));\r\n\r\n/*\r\n\t\tawait me.Acts({\r\n\t\t\taccountCTO: [{\r\n\t\t\t\tid: this.accountId,\r\n\t\t\t\torderAmount: 3,\r\n\t\t\t}],\r\n\t\t});\r\n*/\r\n\t}\r\n}\r\n\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig, DevConfig } from \"tonva-react\";\r\n\r\n/*\r\nconst bz: DevConfig = {\r\n\tname: 'bizdev',\r\n\talias: 'bz',\r\n}\r\n*/\r\nconst jk: DevConfig = {\r\n\tname: '百灵威系统工程部',\r\n\talias: 'jk',\r\n}\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.0',\r\n\tapp: undefined,\r\n\tuqs: [\r\n\t\t{\r\n\t\t\tdev: jk,\r\n\t\t\tname: 'me',\r\n\t\t\talias: 'Me',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t],\r\n\tnoUnit: true,\r\n    tvs: {},\r\n\toem: undefined,\r\n\thtmlTitle: '我',\r\n};\r\n","import { VPage } from \"tonva-react\";\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends VPage<CMe> {\r\n\theader() {return '关于APP';}\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{right:'0', top:'-2.8rem'}}>\r\n\t\t\t\t\t版本: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">About</b>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { observer } from 'mobx-react';\r\nimport { Image, VPage, nav, IconText, PropGrid, LMR, FA, Prop } from 'tonva-react';\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from '../uq-app/appConfig';\r\nimport { VAbout } from './VAbout';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\theader() {return this.t('me')}\r\n\r\n\tcontent() {\r\n        const { user } = nav;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.about}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\" \r\n\t\t\t\t\t\ticon=\"smile-o\" \r\n\t\t\t\t\t\ttext={<>{this.t('aboutTheApp')} <small>版本 {appConfig.version}</small></>} />                    \r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => nav.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n\t}\r\n\r\n\tprivate meInfo = observer(() => {\r\n        let { user } = nav;\r\n        if (user === undefined) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n\tprivate about = () => {\r\n\t\tthis.openVPage(VAbout);\r\n\t}\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport {\r\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\r\n    Edit, UiSchema, VPage, Prop, FA, IconText, PropGrid\r\n} from 'tonva-react';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        nav.user.name = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n\tprivate onExit = () => {\r\n        nav.showLogout();\r\n    }\r\n\r\n\tprivate changePassword = async () => {\r\n        await nav.changePassword();\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet { schema, uiSchema, data, onItemChanged } = this;\r\n\t\tlet gridRows: Prop[] = [\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tcomponent: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('changePassword')} />,\r\n\t\t\t\tonClick: this.changePassword\r\n\t\t\t},\r\n\t\t\t'',\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tbk: '',\r\n\t\t\t\tcomponent: <div className=\"w-100 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n\t\t\t\t\t\t<FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t},\r\n\t\t];\r\n\r\n\r\n\t\t/*\r\n\t\tlet vAdmin: any;\r\n\t\t\r\n\t\tlet { role } = this.controller;\r\n\t\tif ((role & 2) === 2) {\r\n\t\t\tvAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n\t\t}\r\n\t\t{vAdmin}\r\n\t\t*/\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n\t\t\t<PropGrid rows={gridRows} values={{}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { QueryPager, User } from \"tonva-react\";\r\nimport { CUqBase } from \"uq-app\";\r\nimport { VMe } from \"./VMe\";\r\nimport { VEditMe } from \"./VEditMe\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonvaUnit: number;\t\t\t// 跟tonva机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CUqBase {\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\troles: string[] = null;\r\n\t//uq: Uq;\r\n\r\n\tconstructor(res:any) {\r\n\t\tsuper(res);\r\n\t\tmakeObservable(this, {\r\n\t\t\troles: observable,\r\n\t\t});\r\n\t\t//this.uq = this.uqs.BzTimesChange;\r\n\t}\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VMe);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\t//let result = await this.uqs.Notes.GetSystemRole.query({});\r\n\t\t//this.role = result.ret[0]?.role;\r\n\t\tthis.openVPage(VEditMe);\r\n\t}\r\n\r\n\tload = async () => {\r\n\t\t//this.roles = await this.getUqRoles(this.uq.$.name);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\t//let cRoles = new CRoles(this.uq, this.res);\r\n\t\t//await cRoles.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles:string[]) => {\r\n\t\t//this.roles = roles;\r\n\t\t//this.user.roles[this.uq.$.name] = roles;\r\n\t\t//nav.saveLocalUser();\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testTimesChange = {\r\n\tname: 'TimesChange', \r\n\tdiscription: 'Test Times Change hours', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet tc = uqs.BzTimesChange;\r\n\t\tlet ret = await tc.IDActs({\r\n\t\t\tstaff: [\r\n\t\t\t\t{id: undefined, no: '101', firstName: 'Song', lastName: 'Sha'}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\tlet id = 13369344;\r\n\t\tlet r1 = await tc.IDActs({\r\n\t\t\thours: [\r\n\t\t\t\t{id, onsite:{value: 3, time: new Date(2021, 0, 1)}}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(r1);\r\n\r\n\t\tlet month = await tc.IDLog({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: 'onsite',\r\n\t\t\tid,\r\n\t\t\tlog: 'month',\r\n\t\t\ttimeZone: -5,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: undefined,\r\n\t\t\t\tend: new Date(2021,0,1).getTime(),\r\n\t\t\t\tsize: 10,\r\n\t\t\t}\r\n\t\t});\r\n\t\tlog(month);\r\n\r\n\t\tlet sum = await tc.IDSum({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: ['onsite'],\r\n\t\t\tid: [id],\r\n\t\t\tfar: undefined,\r\n\t\t\tnear: new Date().getTime(),\r\n\t\t});\r\n\t\tlog(sum);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { DebugItem } from \"../CBug\";\r\nimport { testTimesChange } from \"./test-times-change\";\r\nimport { testItem1 } from \"./test1\";\r\nimport { testItem2 } from \"./test2\";\r\nimport { testItem3 } from \"./test3\";\r\nimport { testItem4 } from \"./test4\";\r\n\r\nexport const debugItems: DebugItem[] = [\r\n\ttestItem1,\r\n\ttestItem2,\r\n\ttestItem3,\r\n\ttestItem4,\r\n\ttestTimesChange,\r\n];\r\n","import { DebugItem } from \"../CBug\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\n//BzTest, BzHelloTonva, BzCustomerPayment, \r\n\r\nexport const testItem1:DebugItem = {\r\n\tname: 'HelloTonva.GetProductStock',\r\n\tdiscription: '{product: 1}',\r\n\ttest: async ( log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.ID({\r\n\t\t\tIDX: uqs.BzTest.X1,\r\n\t\t\tid: 7077888,\r\n\t\t});\r\n\t\tfor (let item of a) {\r\n\t\t\tlog(item);\r\n\t\t}\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\ttag: [\r\n\t\t\t\t{id: undefined, type: 'a', name: 'b'},\r\n\t\t\t\t{id: undefined, type: 'a', name: 'c'},\r\n\t\t\t\t{id: undefined, type: 'd', name: 'c'},\r\n\t\t\t],\r\n\t\t\tx1: [\r\n\t\t\t\t{id: undefined, a1: 1, a2: 3, a3:5, n5: 7},\r\n\t\t\t\t{id: undefined, a1: 1, a2: 7, a3:51, n5: 71},\r\n\t\t\t],\r\n\t\t\tassign1: [\r\n\t\t\t\t{id: 3, id2: 5, val: 3},\r\n\t\t\t\t{id: 3, id2: 6, val: 30},\r\n\t\t\t],\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: 7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t\t{id: 8, f1: 3.5, f2: 7.2, b: 'bbbbc', c: 2},\r\n\t\t\t],\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet b = await uqs.BzTest.IDDetail<BzTest.OrderMaster, BzTest.OrderDetail>\r\n\t\t({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: uqs.BzTest.OrderMaster,\r\n\t\t\t\tvalue: {customer: 1 },\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: uqs.BzTest.OrderDetail,\r\n\t\t\t\tvalues: [\r\n\t\t\t\t\t{product:11, price:2.0, quantity:3.0, amount:6.0},\r\n\t\t\t\t\t{product:12, price:2.0, quantity:5.0, amount:10.0},\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IDDetailGet<BzTest.OrderMaster, BzTest.OrderDetail>({\r\n\t\t\tid: 8716325,\r\n\t\t\tmaster: uqs.BzTest.OrderMaster,\r\n\t\t\tdetail: uqs.BzTest.OrderDetail,\r\n\t\t});\r\n\r\n\t\tfor (let ci of c) {\r\n\t\t\tlog(ci);\r\n\t\t}\r\n\r\n\t\t//let u: BzHelloTonva.Return$pokedRet;\r\n\t\t//u.poke = 1;\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet f = BzCustomerPayment.EnumCustomerAction.confirm;\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.GetProductStock.query({product: 1});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t}\r\n}","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem2 = {\r\n\tname: '第二测试', \r\n\tdiscription: 'second test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem3 = {\r\n\tname: '第三测试', \r\n\tdiscription: 'third test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.IDLog({\r\n\t\t\tIDX: uqs.BzTest.IBook1,\r\n\t\t\tfield: 'f2',\r\n\t\t\tid: 7,\r\n\t\t\tlog: 'each',\r\n\t\t\tpage: {start:undefined, size: 50},\r\n\t\t});\r\n\t\tlog(a);\r\n\r\n\t\tlet b = await uqs.BzTest.KeyID({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t});\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t\tid: 3,\r\n\t\t});\r\n\t\tlog(c);\r\n\r\n\t\tlet d = await uqs.BzTest.KeyIX({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t});\r\n\t\tlog(d);\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: -7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem4 = {\r\n\tname: 'Tag测试', \r\n\tdiscription: 'Tag Test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.CustomerTag,\r\n\t\t\tid: 1,\r\n\t\t\tIDX: [uqs.BzTest.Tag],\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CBug, DebugItem } from \"./CBug\";\r\n\r\nexport class VBug extends VPage<CBug> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tDebug\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.debugItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.controller.test}>test</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:DebugItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={() => this.controller.openDebugPage(item)}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { VPage } from \"tonva-react\";\r\nimport { CBug } from \"./CBug\";\r\n\r\nexport class VConsole extends VPage<CBug> {\r\n\tprivate div: HTMLDivElement;\r\n\tprivate divBottom: HTMLDivElement;\r\n\tinit() {\r\n\t\tthis.startAutoScrollToBottom();\r\n\t}\r\n\theader() {\r\n\t\treturn this.controller.currentItem.name;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {currentItem} = this.controller;\r\n\t\tlet {name, discription} = currentItem;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div>{discription}</div>\r\n\t\t\t</div>\r\n\t\t\t<div ref={t => this.div = t} className=\"p-3 border-top border-primary bg-light\" />\r\n\t\t\t<div ref={t => this.divBottom = t} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private lastScrollTop = 0;\r\n    private timeHandler:any;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            this.divBottom?.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n\tprotected onPageScroll(e:any) {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n\t}\r\n\r\n\tlog = (message?: any):void => {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.div);\r\n\t\tlet html:string;\r\n\t\tif (!message) {\r\n\t\t\thtml = '<div>&nbsp;</div>';\r\n\t\t}\r\n\t\telse if (typeof message === 'object') {\r\n\t\t\thtml = this.objToHtml(message);\r\n\t\t}\r\n\t\telse {\r\n\t\t\thtml = '<div>' + message + '</div>';\r\n\t\t}\r\n\t\tconst child = range.createContextualFragment(html);\r\n\t\tthis.div.appendChild(child);\r\n\t}\r\n\r\n\tprivate objToHtml(obj: any) {\r\n\t\tif (obj === null) return '<div>null</div>';\r\n\t\tif (obj === undefined) return '<div>undefined</div>';\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn this.arrToHtml(0, obj);\r\n\t\t}\r\n\t\tlet ret = '<div>{</div>';\r\n\t\tfor (let i in obj) {\r\n\t\t\tret += this.indent(1) + i + ': ';\r\n\t\t\tlet v = obj[i];\r\n\t\t\tif (Array.isArray(v) === true) {\r\n\t\t\t\tret += this.arrToHtml(1, v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tret += this.objToString(v);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret += '<div>}</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indent(n:number) {\r\n\t\tif (!n) return '';\r\n\t\tlet ret = '';\r\n\t\tn = n*2;\r\n\t\tfor (let i=0; i<n; i++) ret += '&emsp;';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate objToString(obj: any) {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn 'array[' + obj.length + ']';\r\n\t\t}\r\n\t\tswitch (typeof obj) {\r\n\t\tdefault: return obj.toString();\r\n\t\tcase 'undefined': return 'undefined';\r\n\t\tcase 'object':\r\n\t\t\tif (obj.tuid === undefined) {\r\n\t\t\t\treturn 'obj';\r\n\t\t\t}\r\n\t\t\treturn obj.id;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate objToLine(indent:number, obj:any) {\r\n\t\tlet first = true;\r\n\t\tlet ret = '<div>' + this.indent(indent) + '{ ';\r\n\t\tfor (let i in obj) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tret += ', ';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tret += i + ':' + this.objToString(obj[i]);\r\n\t\t}\r\n\t\tret += ' }</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indentVal(indent:number, val:any):string {\r\n\t\treturn '<div>' + this.indent(indent) + val + '</div>'\r\n\t}\r\n\tprivate arrToHtml(indent:number, arr:any[]) {\r\n\t\tlet ret = '<div>' + this.indent(indent) + '[</div>';\r\n\t\tfor (let item of arr) {\r\n\t\t\tlet t:string|number;\r\n\t\t\tswitch (typeof item) {\r\n\t\t\t\tdefault: t = this.indentVal(indent+1, item); break;\r\n\t\t\t\tcase 'object': t = this.objToLine(indent+1, item); break;\r\n\t\t\t\tcase 'string': t = this.indentVal(indent+1, `'${item}'`); break;\r\n\t\t\t}\r\n\t\t\tret += t;\r\n\t\t}\r\n\t\tret += '<div>' + this.indent(indent) + ']</div>';\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { CUqBase, UQs } from \"uq-app\";\r\nimport { Log } from \"./Logger\";\r\nimport { debugItems } from \"./tester\";\r\nimport { VBug } from \"./VBug\";\r\nimport { VConsole } from \"./VConsole\";\r\n\r\nexport interface DebugItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\ttest: (log:Log, uqs: UQs) => Promise<void>;\r\n}\r\n\r\nexport class CBug extends CUqBase {\r\n\tdebugItems = [...debugItems];\r\n\tcurrentItem: DebugItem;\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VBug);\r\n\r\n\tload = async () => {\r\n\r\n\t}\r\n\r\n\topenDebugPage = async (item:DebugItem) => {\r\n\t\tthis.currentItem = item;\r\n\t\tlet console = await this.openVPage(VConsole);\r\n\t\tlet {test} = item;\r\n\t\tlet start = new Date();\r\n\t\tconsole.log(`=== test start at ${start} ===`);\r\n\t\tconsole.log();\r\n\t\tawait test(console.log, this.uqs);\r\n\t\tlet span = Date.now() - start.getTime();\r\n\t\tlet ms = (1000 + (span % 1000)).toString().substr(1);\r\n\t\tlet s = Math.floor(span / 1000);\r\n\t\tlet m = Math.floor(s / 60);\r\n\t\tlet t = '';\r\n\t\tif (m > 0) t += ms + '\\'';\r\n\t\tt += s + '\"' + ms;\r\n\t\tconsole.log();\r\n\t\tconsole.log(`=== test end: ${t} ===`);\r\n\t}\r\n\r\n\ttest = async () => {\r\n\t\tlet uqName = 'BizDev/hello-tonva';\r\n\t\tlet roles = await this.getUqRoles(uqName);\r\n\t\talert(roles);\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n}\r\n","//=== UqApp builder created on Tue Jan 05 2021 18:41:24 GMT-0500 (GMT-05:00) ===//\r\nimport { VPage, TabProp, TabCaptionComponent, t, TabsProps, PageWebNav } from 'tonva-react';\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label:string|JSX.Element, icon:string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\tlet { cHome, cMe/*, cBug, cUI*/ } = this.controller;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab},\r\n\t\t\t{name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load},\r\n\t\t];\r\n\t\t/*\r\n\t\tif (this.isDev === true) {\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'UI', caption: caption(t('UI'), 'television'), content: cUI.tab\r\n\t\t\t});\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'debug', caption: caption(t('debug'), 'bug'), content: cBug.tab, onShown: cBug.load\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\t\treturn {tabs};\r\n\t}\r\n\r\n\tprotected get webNav(): PageWebNav {\r\n\t\treturn {\r\n\t\t\tnavHeader: <div>webNav header</div>, \r\n\t\t\tnavFooter: <div>webNav footer</div>,\r\n\t\t};\r\n\t}\r\n}\r\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CTester, UIItem } from \"./CTest\";\r\n\r\nexport class VTester extends VPage<CTester> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tUI\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.uiItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:UIItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription, click} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={click}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import { CBase/*, Context*/ } from \"tonva-react\";\r\n/*\r\nimport { CID, MidID, CIDX, MidIDX, MidTag, CIDTagList, CTagIDList\r\n\t, SheetUI, MidIDTagList, CSheetNew, MidSheet } from \"tonva-uqui\";\r\n*/\r\nimport { CApp, UQs } from \"uq-app\";\r\n//import { OrderDetail, OrderMaster } from \"uq-app/uqs/BzHelloTonva\";\r\nimport { VTester } from \"./VTest\";\r\n//import { isNumber } from \"lodash\";\r\n\r\nexport interface UIItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\tclick: () => Promise<void>;\r\n}\r\n\r\nexport class CTester extends CBase<CApp,UQs> {\r\n\treadonly uiItems:UIItem[] = [\r\n\t\t/*\r\n\t\t{\r\n\t\t\tname: 'customer',\r\n\t\t\tdiscription: '客户信息',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Customer});\r\n\t\t\t\tlet cID = new CID(mid);\r\n\t\t\t\tawait cID.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tag',\r\n\t\t\tdiscription: '客户标签',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet midIDTagList = new MidIDTagList(midTag);\r\n\t\t\t\tlet cIDTagList = new CIDTagList(midIDTagList);\r\n\t\t\t\tawait cIDTagList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tagCustomer',\r\n\t\t\tdiscription: '标签客户',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet cTagIDList = new CTagIDList(midTag);\r\n\t\t\t\tawait cTagIDList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'staff',\r\n\t\t\tdiscription: 'TimeChange Staff',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Staff});\r\n\t\t\t\tlet cStaff = new CID(mid);\r\n\t\t\t\tcStaff.renderItem = (item:any, index:number): JSX.Element => {\r\n\t\t\t\t\treturn <div className=\"\">{uq.Staff.render(item)}</div>\r\n\t\t\t\t};\r\n\t\t\t\tawait cStaff.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'hours',\r\n\t\t\tdiscription: 'TimeChange Hours',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidIDX(uq, uq.Hours, uq.Staff, this.timeZone);\r\n\t\t\t\tlet cHours = new CIDX(mid);\r\n\t\t\t\tawait cHours.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'sheet-order',\r\n\t\t\tdiscription: 'Sheet Order Hello Tonva',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet onChanged = async (context:Context, value:any, prev:any) => {\r\n\t\t\t\t\tlet quantity = context.getValue('quantity');\r\n\t\t\t\t\tlet price = context.getValue('price');\r\n\t\t\t\t\tif (isNumber(quantity) && isNumber(value)) {\r\n\t\t\t\t\t\tcontext.setValue('amount', (price*quantity).toFixed(2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet sheetUI:SheetUI = {\r\n\t\t\t\t\tmaster: {\r\n\t\t\t\t\t\tID: uq.OrderMaster,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tcustomer: {ID: uq.Customer},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tID: uq.OrderDetail,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tproduct: { ID: uq.Customer },\r\n\t\t\t\t\t\t\tprice: { onChanged },\r\n\t\t\t\t\t\t\tquantity: { onChanged },\r\n\t\t\t\t\t\t\tamount: { readOnly: true, }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet mid = new MidSheet<OrderMaster, OrderDetail>(uq, sheetUI, this.res);\r\n\t\t\t\tlet cSheetNew = new CSheetNew(mid);\r\n\t\t\t\tawait cSheetNew.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t*/\r\n\t];\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VTester);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VTester);\r\n}\r\n","import { CHome } from \"../home\";\r\nimport { CMe } from \"../me\";\r\nimport { CBug } from \"./bug\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { CTester } from \"./test-uqui\";\r\nimport { setUI } from \"./uqs\";\r\n\r\n//const gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\tcHome: CHome;\r\n\tcBug: CBug;\r\n\tcMe: CMe;\r\n\tcUI: CTester;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cBug = this.newC(CBug);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cUI = this.newC(CTester) as CTester;\r\n\t\tthis.cHome.load();\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\t// this.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer:any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\t/*\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\t//console.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.BzHelloTonva.$poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\r\n\t\t\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\t\t\t//this.cHome.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n\t*/\r\n}\r\n","//=== UqApp builder created on Fri Apr 09 2021 16:55:02 GMT-0400 (GMT-04:00) ===//\r\nimport * as JkMe from './JkMe';\r\n\r\nexport interface UQs {\r\n\tJkMe: JkMe.UqExt;\r\n}\r\n\r\nexport * as JkMe from './JkMe';\r\n\r\nexport function setUI(uqs:UQs) {\r\n\tJkMe.setUI(uqs.JkMe);\r\n}\r\n","//=== UqApp builder created on Wed Mar 10 2021 16:02:48 GMT-0500 (GMT-05:00) ===//\r\nimport { NavView, start, nav } from 'tonva-react';\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n\tnav.setSettings(appConfig);\r\n\tconst onLogined = async (isUserLogin?:boolean) => {\r\n\t\tawait start(CApp, appConfig, isUserLogin);\r\n\t}\r\n\treturn <NavView onLogined={onLogined} />;\r\n}\r\n\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { App } from 'uq-app';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}